
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../network/">
      
      
        <link rel="next" href="../software/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44+insiders-4.53.14">
    
    
      
        <title>Secure boot - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.12320a83.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343za8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746m1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275M6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.75.75 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L6.94 8 4.97 6.03a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.5 3.5 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327q0 .15-.025.292c.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5q-.002.615-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A5 5 0 0 1 8 16a5 5 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5 5 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.7 1.7 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06m.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.17.17 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#truly-secure-boot" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Secure boot
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  MkDocs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../C%2B%2B/" class="md-tabs__link">
        
  
    
  
  C++

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../Rust/" class="md-tabs__link">
        
  
    
  
  Rust

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../English/Grammar/01.Infinitive/" class="md-tabs__link">
          
  
  English

        </a>
      </li>
    
  

    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../alternatives/" class="md-tabs__link">
          
  
  Linux

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    MkDocs
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../C%2B%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    C++
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Rust/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Rust
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    English
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    English
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Grammar
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Grammar
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Grammar/01.Infinitive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Infinitive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Grammar/02.-ing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    -ing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Grammar/03.ModalVerbs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Modal Verbs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Grammar/04.SomethingFollowedBySomething/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    something followed by something rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Grammar/05.Articles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Articles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Grammar/06.Other/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Other
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Grammar/07.UnitsFromMurphy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Some units from Murphy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Vocabulary
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vocabulary
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/10.RareWords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Rare Words
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/20.WordUsage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Word Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/30.PhrasesIdiomsCollacations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Phrases, Idioms & Collacations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/40.CommonWordsUncommonMeaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Common words with uncommon meaning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/41.ReplacementForVery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Replacement for "very"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/42.UAndNonU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    U and Non-U
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/43.CollectiveNouns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Collective Nouns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/44.ReportingVerbs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Reporting Verbs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/45.WaysOfMoving/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Ways of Moving
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/46.RelatedWords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Related Words
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/50.LinkingWords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Linking Words
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/55.Conjunctions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Conjunction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/90.Prefixes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Prefixes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../English/Vocabulary/91.Suffixes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Suffixes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../alternatives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Alternatives
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apt_repos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    apt repos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../certificates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../disks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Disks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    Secure boot
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    Secure boot
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#boot-process-digest" class="md-nav__link">
    <span class="md-ellipsis">
      
        Boot process &mdash; digest
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Boot process — digest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu-firmware" class="md-nav__link">
    <span class="md-ellipsis">
      
        CPU firmware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uefi-firmware" class="md-nav__link">
    <span class="md-ellipsis">
      
        UEFI firmware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shim" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub" class="md-nav__link">
    <span class="md-ellipsis">
      
        GRUB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-initrd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kernel &amp; Initrd
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        The plan
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customisation-points-low-level-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customisation points &amp; Low-level Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customisation points & Low-level Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssl-certificates-in-uefi" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSL Certificates in UEFI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSL Certificates in UEFI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-the-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get the list
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        View details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-a-new-ssl-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate a new SSL key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enrolling-the-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enrolling the certificates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-signatures-listing-signing-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSL Signatures: Listing &amp; Signing &amp; Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSL Signatures: Listing & Signing & Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-list-of-signatures-from-a-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get list of signatures from a file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-signatures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remove signatures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sign" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sign
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hashes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hashes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        GRUB
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRUB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protecting-grub-configs-on-disk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protecting GRUB configs on disk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protecting-grub-configs-from-within-grub" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protecting GRUB configs from within GRUB
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-step instructions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-step instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buy-equipment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Buy equipment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-ssluefi-keys-and-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate SSL/UEFI keys and certificates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-grub-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        For GRUB users
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For GRUB users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-gpg-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate GPG keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub-password-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        GRUB password hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-new-boot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate new boot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-efi-stub-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        For EFI Stub Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enroll-your-uefi-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enroll your UEFI keys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enroll your UEFI keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-your-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get your certificates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-certificates-to-media-accessible-from-uefi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Move certificates to media accessible from UEFI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reboot-and-enroll" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reboot and enroll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-down-uefi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lock-down UEFI
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reboot-and-check-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reboot and check it works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-case-of-an-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        In case of an error
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-proper-testing-in-a-vm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional Proper testing in a VM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional Proper testing in a VM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-vm-semi-manually" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup VM (semi-manually)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-automated-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run automated test
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-qemu-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Useful QEMU commands
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Software
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools_and_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tools & Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usb_udev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    usb & udev
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../video_editing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Video editing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Apps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Apps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/bash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    bash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/cmake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    cmake
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/fail2ban/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Fail2Ban
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/lldb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    lldb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/openssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    OpenSSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/qt_qtcreator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Qt & QtCreator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/ripgrep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    ripgrep
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/screen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    screen
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    ssh
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/strace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    strace
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apps/systemd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    systemd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Performance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/010.performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/020.concurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Concurrency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/030.memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    memory usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/040.asm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    asm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/050.Gregg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Brendan Gregg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/110.tools-orbit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tools: orbit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/120.tools-perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tools: perf
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#boot-process-digest" class="md-nav__link">
    <span class="md-ellipsis">
      
        Boot process &mdash; digest
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Boot process — digest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu-firmware" class="md-nav__link">
    <span class="md-ellipsis">
      
        CPU firmware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uefi-firmware" class="md-nav__link">
    <span class="md-ellipsis">
      
        UEFI firmware
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shim" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shim
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub" class="md-nav__link">
    <span class="md-ellipsis">
      
        GRUB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-initrd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kernel &amp; Initrd
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-plan" class="md-nav__link">
    <span class="md-ellipsis">
      
        The plan
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#customisation-points-low-level-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Customisation points &amp; Low-level Tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Customisation points & Low-level Tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssl-certificates-in-uefi" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSL Certificates in UEFI
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSL Certificates in UEFI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-the-list" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get the list
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-details" class="md-nav__link">
    <span class="md-ellipsis">
      
        View details
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-a-new-ssl-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate a new SSL key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enrolling-the-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enrolling the certificates
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssl-signatures-listing-signing-verification" class="md-nav__link">
    <span class="md-ellipsis">
      
        SSL Signatures: Listing &amp; Signing &amp; Verification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSL Signatures: Listing & Signing & Verification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-list-of-signatures-from-a-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get list of signatures from a file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-signatures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remove signatures
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sign" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sign
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify" class="md-nav__link">
    <span class="md-ellipsis">
      
        Verify
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hashes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hashes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        GRUB
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GRUB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#protecting-grub-configs-on-disk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protecting GRUB configs on disk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#protecting-grub-configs-from-within-grub" class="md-nav__link">
    <span class="md-ellipsis">
      
        Protecting GRUB configs from within GRUB
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-by-step-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Step-by-step instructions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Step-by-step instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buy-equipment" class="md-nav__link">
    <span class="md-ellipsis">
      
        Buy equipment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-ssluefi-keys-and-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate SSL/UEFI keys and certificates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-grub-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        For GRUB users
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For GRUB users">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-gpg-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate GPG keys
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#grub-password-hash" class="md-nav__link">
    <span class="md-ellipsis">
      
        GRUB password hash
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-new-boot" class="md-nav__link">
    <span class="md-ellipsis">
      
        Generate new boot
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-efi-stub-users" class="md-nav__link">
    <span class="md-ellipsis">
      
        For EFI Stub Users
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enroll-your-uefi-keys" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enroll your UEFI keys
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enroll your UEFI keys">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-your-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get your certificates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-certificates-to-media-accessible-from-uefi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Move certificates to media accessible from UEFI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reboot-and-enroll" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reboot and enroll
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lock-down-uefi" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lock-down UEFI
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reboot-and-check-it-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        Reboot and check it works
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#in-case-of-an-error" class="md-nav__link">
    <span class="md-ellipsis">
      
        In case of an error
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optional-proper-testing-in-a-vm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optional Proper testing in a VM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional Proper testing in a VM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-vm-semi-manually" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup VM (semi-manually)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-automated-test" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run automated test
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#useful-qemu-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Useful QEMU commands
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resources
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="truly-secure-boot"><span class="critic comment">Truly </span> <strong>Secure boot</strong><a class="headerlink" href="#truly-secure-boot" title="Permanent link">&para;</a></h1>
<div class="admonition abstract">
<p class="admonition-title">TL;DR</p>
<p>We are going to sign everything pertaining to the boot process (including <code>grub.cfg</code> and <code>initrd</code>)
with your <strong>own</strong> keys.</p>
<p>You can jump directly to <a href="#step-by-step-instructions">Step-by-step instructions</a>.</p>
</div>
<h2 id="boot-process-digest"><strong>Boot process</strong> &mdash; digest<a class="headerlink" href="#boot-process-digest" title="Permanent link">&para;</a></h2>
<h5 id="cpu-firmware">CPU firmware<a class="headerlink" href="#cpu-firmware" title="Permanent link">&para;</a></h5>
<ol>
<li>
<p class="annotate">Loosely speaking, a &ldquo;CPU inside CPU&rdquo; starts first. More precisely, Firmware inside PCH (1) or BMC (2) is executed first. Intel Management Engine runs in the PCH and starts before the CPU.</p>
<ol>
<li>platform controller hub</li>
<li>baseboard management controller</li>
</ol>
</li>
<li>
<p>It performs basic hardware configuration and allows the CPU to come out of reset.</p>
</li>
<li>
<p>The first instruction that CPU executes is the instruction from 16-bytes below 4GB.</p>
<details class="info">
<summary>What is there?</summary>
<ul>
<li>SPI flash memory is mapped to the top of the 32-bit address space.</li>
<li>Reads are forwarded by the chipset to the flash device.</li>
<li>The instruction at 0xFFFFFFF0 is a JMP instruction to the start of the UEFI platform initialization code (SEC phase)</li>
</ul>
<p>Other relevant low-level things and keywords:</p>
<ul>
<li>The Boot Block: SEC and PEI phase code.</li>
<li>Variable store for UEFI Variables and default settings.</li>
<li>SEC Phase sets up the UEFI environment and passes control to PEI Core.</li>
<li>PEI Dispatcher dispatches PEI Modules (PEIMs) that perform early hardware and memory initialization.</li>
<li>PEI Core passes control to DXE Core.</li>
<li>DXE drivers perform additional hardware initialization and configuration.</li>
</ul>
</details>
</li>
</ol>
<h5 id="uefi-firmware">UEFI firmware<a class="headerlink" href="#uefi-firmware" title="Permanent link">&para;</a></h5>
<p>UEFI firmware allows users to enroll (add) their own SSL certificates (this should be protected with a password). So, given
certificates it verifies everything up to (and including) first-stage bootloader (<code>shim</code>).</p>
<ol>
<li>
<p class="annotate">UEFI firmware mounts first partition (1). UEFI-bootable binaries are then stored as files in the <code>/EFI/BOOT/</code> directory.</p>
<ol>
<li>The first partition is expected to have partition ID of <code>0xEF00</code> and be formatted as a FAT32 filesystem</li>
</ol>
</li>
<li>
<p>UEFI firmware verifies signatures of the EFI executables using SSL certificates and hashsums.</p>
<ul>
<li>There are several types of certificates and hashsum stores:<ul>
<li>Platform Key (PK) stores (usually) a single certificate. Does not sign executables directly, but signs other keys.</li>
<li>Key Exchange Key (KEK) can store multiple certificates.</li>
<li>Blacklist (dbx) and whitelist (db). They can store both certificates and hashsums.</li>
</ul>
</li>
</ul>
<details class="info">
<summary>What is certificate and how UEFI verifies signatures?</summary>
<p>A certificate is a public key. Below is how signing and verification works. Remember that only you have private
key, and everyone else (including UEFI firmware) - public key.</p>
<ul>
<li><strong>Signing</strong>: You calculate a hash of a module and encrypt it with your private key. Then you attach the result
  (signature) to a file (UEFI module in our case).</li>
<li><strong>Verification</strong>: The idea is to get (presumably) the same hash in two independent ways and compare them.
   The 1st way: decrypt the attached signature with the public key (which UEFI has). The 2nd way: calculate hash
   ourselves (given the module file). If they are equal UEFI knows that the module was created and placed there by
   whoever poses and controls private key.</li>
</ul>
<p>A certificates has certain capabilities. For example, certificates generated by <code>update-secureboot-policy</code> can only
sign kernel modules (KeyUsage OID (1.3.6.1.4.1.2312.16.1.2)). They are stored at local file-system.</p>
</details>
</li>
<li>
<p>(Unless UEFI firmware is configured for multi-boot), UEFI executes a EFI binary with the default name, which is
  <code>BOOTX64.EFI</code>. In case of Linux, the binary is <code>shim</code>.</p>
<ul>
<li>To add a new EFI binary to your firmware&rsquo;s list of available binaries, you should use the <code>efibootmgr</code> utility.</li>
</ul>
</li>
</ol>
<p>At this point, there are two alternatives: (1) control can be passed to shim, which passes control to grub, which passes
control to kernel or (2) control can be passed directly to kernel (EFI Stub &amp; Systemd-boot):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Shim -&gt; GRUB -&gt; Kernel &amp; Initrd</label><label for="__tabbed_1_2">EFI Stub &amp; Systemd-boot</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<h5 id="shim">Shim<a class="headerlink" href="#shim" title="Permanent link">&para;</a></h5>
<p class="annotate">In addition to the aforementioned PK/KEK/DB/DBX, <code>shim</code> uses its own storage of keys and certificates called MOK (1).
Shim is supposed to verify everything else: second-stage bootloader (GRUB), kernel, kernel drivers. Shim can:</p>
<ol>
<li>machine owner keys</li>
</ol>
<ul>
<li>start <code>MokManager</code>. <code>MokManager</code> allows a user to enroll keys, remove trusted keys, enroll binary hashes and toggle Secure
Boot validation at the <code>shim</code> level. Unfortunately, <code>MokManager</code> does not have any protection from an adversary &mdash; it allows
anyone to enroll new certificates, and does not require any protection &mdash;
<a href="https://askubuntu.com/a/1334366/826568">it is too helpful</a>. So, in this guide we will remove it completely.</li>
<li>or <code>shim</code><ol>
<li>verifies GRUB and Linux kernel.</li>
<li>and then passes execution to GRUB.</li>
</ol>
</li>
</ul>
<h5 id="grub">GRUB<a class="headerlink" href="#grub" title="Permanent link">&para;</a></h5>
<p>This is the point where <em>UEFI</em>&rsquo;s SecureBoot starts to fade away. While GRUB performs checks of some files (linux
kernel, <code>vmlinuz</code>) using UEFI&rsquo;s certificates, it does not check everything that it loads and uses with <em>UEFI</em> certificates.
Luckily, GRUB has an option to check everything that it loads with GPG keys (a mechanism that is completely unrelated to
UEFI certificates, but conceptually similar to what UEFI does). So, GRUB:</p>
<ol>
<li>Reads and loads its own config from <code>/boot/grub/</code> (which means that the the configs has to be protected from
tampering &mdash; we are going to sign GRUB config with GPG).</li>
<li>Provides user with a bunch of options (including rescue shell) as to how to proceed (so, this is another thing
that has to be protected &mdash; we will create a special GRUB superuser + password).</li>
<li>
<p class="annotate">Loads initrd (1) and kernel in memory and passes execution to the kernel (we will sign both initrd and kernel with GPG).
Only kernel is verified with UEFI certificates in default configuration. So, Initrd should be signed with GPG.</p>
<ol>
<li>initrd is a tiny part of user-space of a real OS, the only purposes of which is to figure-out how to proceed booting
    (mounting disks, decrypting, loading from NFS, handling DHCP and so on&hellip;). The <code>init</code> script is the main entry point.
    More info <a href="https://www.linuxquestions.org/questions/linux-server-73/difference-between-initrd-and-vmlinuz-images-892868/">here</a>.</li>
</ol>
</li>
</ol>
<h5 id="kernel-initrd">Kernel &amp; Initrd<a class="headerlink" href="#kernel-initrd" title="Permanent link">&para;</a></h5>
<p>Kernel then:</p>
<ol>
<li>Executes init script from initrd.</li>
<li>The init scripts does whatever it needs to mount real FS.</li>
<li>And finally, replaces itself with real <code>/sbin/init</code> from real FS.</li>
</ol>
</div>
<div class="tabbed-block">
<p>There is another option, however. Linux kernel is provided as a EFI binary, and therefore can be verified and loaded
directly by UEFI firmware. This has a number of advantages:</p>
<ul>
<li>This approach is much simpler</li>
<li>fewer moving parts</li>
<li>
<p class="annotate">faster boots (1)</p>
<ol>
<li>in qemu VM 57s in case of shim/GRUB vs 11s in case of unified kernel image</li>
</ol>
</li>
<li>
<p>decreased surface for helpful &ldquo;features&rdquo; (such as MokManager)</p>
</li>
<li>Fewer files to sign:<ul>
<li>surface for mistake is less.</li>
<li>no need to create GPG keys.</li>
</ul>
</li>
</ul>
<p>The only thing that needs to be addressed in this scenario is initrd. Luckily, it is possible to create a &ldquo;unified
kernel image&rdquo; that includes everything that is needed to start kernel (kernel itself, initrd, kernel start options).
The image then can be signed as usual and loaded by UEFI firmware.</p>
<p>To give you a taste of how simpler this option is, below a complete example of making non-unified kernel boot: (in
case of unified kernel image, we need one invocation of <code>objcopy</code> command before):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>$<span class="w"> </span>efibootmgr<span class="w"> </span>-c<span class="w"> </span>-L<span class="w"> </span>MyEFIStubLinux<span class="w"> </span>-l<span class="w"> </span>/vmlinuz.efi<span class="w"> </span>-u<span class="w"> </span><span class="s1">&#39;initrd=\initrd.img root=/dev/mapper/vgkubuntu-root ro&#39;</span>
</code></pre></div>
<ul>
<li>Where the value of the <code>-u</code> option can be copied from <code>/proc/cmdline</code>.</li>
<li>And <code>vmlinuz.efi</code> and <code>initrd.img</code> should be copied from <code>/boot</code> to <code>/boot/efi</code>.</li>
</ul>
</div>
</div>
</div>
<details class="info">
<summary>Other info</summary>
<p>Note, that some TPMs (Titan M) can start even before (1), checking integrity of itself and UEFI, and only
then starting CPU.</p>
<p>There are also several types of boot:</p>
<ul>
<li>Thorough or Full Boot provides the maximum amount of protection by using Secure Boot throughout the boot
process. Integrity, signature, and hash checks are performed.</li>
<li>Fast Boot or Minimal Boot minimizes boot time by skipping numerous checks, which may or may not include
Secure Boot checks. Boot speed is prioritized over some security features and/or additional features and
peripheral support at boot time. Malware like LoJax can slip by on some systems (Schlej 2018). When Fast
Boot is a configurable toggle, disabling Fast Boot typically results in Thorough Boot.</li>
<li>Automatic Boot attempts to detect when changes have occurred to the early stages of UEFI boot. Automatic
Boot invokes Fast/Minimal Boot when no changes are detected. Thorough/Full Boot is invoked once after each
significant change is detected.</li>
</ul>
</details>
<hr />
<h2 id="the-plan"><strong>The plan</strong><a class="headerlink" href="#the-plan" title="Permanent link">&para;</a></h2>
<p>Below we are going to:</p>
<ul>
<li>Generate our own SSL keys and certificates. The keys can be stored on filesystem or Yubikey.</li>
<li><span class="critic comment">Only if you chose to use GRUB</span> Generate our own GPG keys. The keys can be stored on filesystem or Yubikey.</li>
<li>Remove existing signatures from UEFI binaries (in <code>/boot/efi</code>) and sign them and Linux kernel (<code>vmlinuz-</code>) with SSL.</li>
<li><span class="critic comment">Only if you chose to use GRUB</span> Sign Linux kernel, initrd, grub configs with GPG.</li>
<li><span class="critic comment">Only if you chose to use GRUB</span> Configure GRUB in such a way that it verifies everything it loads, and create
  a password-protected <code>root</code> user for GRUB.</li>
<li><span class="critic comment">Only if you chose to use EFI stub / unified kernel</span> Create a unified kernel image.</li>
<li>Reboot and enroll SSL certificates in UEFI.</li>
</ul>
<p>We also want to simplify and automate the process because we will need to run it repeatedly (potentially, on each system update).</p>
<hr />
<h2 id="customisation-points-low-level-tools"><strong>Customisation points &amp; Low-level Tools</strong><a class="headerlink" href="#customisation-points-low-level-tools" title="Permanent link">&para;</a></h2>
<p>We are going to use a helper script, but it is always useful to understand how to accomplish each step yourself.
You might need it in case something goes wrong and you need to fix it from a live usb.</p>
<h3 id="ssl-certificates-in-uefi"><strong>SSL Certificates in UEFI</strong><a class="headerlink" href="#ssl-certificates-in-uefi" title="Permanent link">&para;</a></h3>
<h5 id="get-the-list">Get the list<a class="headerlink" href="#get-the-list" title="Permanent link">&para;</a></h5>
<p>Get the list of existing and enrolled certificates in UEFI:</p>
<p>Using <code>efi-readvar</code> (Install via: <code>sudo apt install efitools</code>)</p>
<ul>
<li><code>efi-readvar</code> &mdash; will print everything.</li>
<li>Extract PK/KEK/db via:  <code>efi-readvar -v PK -o PK.old.esl</code> and save the files somewhere.</li>
<li>Extract der certificates from ESL with: <code>sig-list-to-certs sec_out/KEK.old.esl KEK</code></li>
</ul>
<p>Using <code>mokutil</code>: <code>mokutil --pk</code>, <code>mokutil --kek</code>, <code>mokutil --db</code>, <code>mokutil --list-enrolled</code>.</p>
<h5 id="view-details">View details<a class="headerlink" href="#view-details" title="Permanent link">&para;</a></h5>
<ul>
<li><code>openssl x509 -inform pem -in PK.crt -text</code></li>
<li><code>openssl x509 -inform der -in /var/lib/shim-signed/mok/MOK.der -text</code></li>
</ul>
<h5 id="generate-a-new-ssl-key">Generate a new SSL key<a class="headerlink" href="#generate-a-new-ssl-key" title="Permanent link">&para;</a></h5>
<p>On filesystem:</p>
<ul>
<li>Generate private key and PEM-encoded certificate:
    <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>–new<span class="w"> </span>-x509<span class="w"> </span>–newkey<span class="w"> </span>rsa:2048<span class="w"> </span>–subj<span class="w"> </span><span class="s2">&quot;/CN=Custom PK/&quot;</span><span class="w"> </span>–keyout<span class="w"> </span>PK.key<span class="w"> </span>–out<span class="w"> </span>PK.crt<span class="w"> </span>–days<span class="w"> </span><span class="m">3650</span><span class="w"> </span>–nodes<span class="w"> </span>–sha256
</code></pre></div>
    It will generate a new 2048 bit key, <code>PK.key</code> is a private key, and <code>PK.crt</code> is the corresponding certificate (public key).</li>
<li>Convert certificate from PEM encoding to DER: <code>openssl x509 -outform der -in PK.crt   -out PK.cer</code> .
  You will need to install it into the UEFI firmware.</li>
<li>Also, you might want to generate ESL (EFI Sig List) from your certificates.</li>
</ul>
<p>On Yubikey:</p>
<ul>
<li>You can generate certificate as above and then import it to Yubikey.
  <a href="https://developers.yubico.com/yubico-piv-tool/Actions/key_import.html">More Info</a>.</li>
<li>Or you can generate them directly on Yubikey.
  <a href="https://developers.yubico.com/yubico-piv-tool/Actions/key_generation.html">More Info</a>.</li>
</ul>
<p>Note, the above will generate only one key/certificates (PK). You need to repeat the process for KEK and db.</p>
<h5 id="enrolling-the-certificates">Enrolling the certificates<a class="headerlink" href="#enrolling-the-certificates" title="Permanent link">&para;</a></h5>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">From within UEFI</label><label for="__tabbed_2_2">At shim/OS level</label><label for="__tabbed_2_3">UEFI from OS</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>This is the most reliable method.</p>
<p>Reboot, go to SecureBoot settings in UEFI, remove existing ones and add new ones.</p>
</div>
<div class="tabbed-block">
<ul>
<li><code>sudo update-secureboot-policy --new-key</code> &mdash; generates a new key/certificate. It will be stored in
  <code>/var/lib/shim-signed/mok/MOK.der</code>, <code>/var/lib/shim-signed/mok/MOK.priv</code> (check it with <code>sudo locate MOK</code>).</li>
<li><code>sudo update-secureboot-policy --enroll-key</code> adds the key in the list.</li>
</ul>
</div>
<div class="tabbed-block">
<p>Reboot, disable Secure Boot, and then:</p>
<ul>
<li>db: <code>efi-updatevar -e -f dsk1.esl db</code></li>
<li>hashes: <code>efi-updatevar -a -e -f hashes.esl db</code></li>
<li>KEK: <code>efi-updatevar -e -f KEK.esl KEK</code></li>
<li>PK: <code>efi-updatevar -e -f PK.esl PK</code></li>
</ul>
</div>
</div>
</div>
<h3 id="ssl-signatures-listing-signing-verification"><strong>SSL Signatures: Listing &amp; Signing &amp; Verification</strong><a class="headerlink" href="#ssl-signatures-listing-signing-verification" title="Permanent link">&para;</a></h3>
<h5 id="get-list-of-signatures-from-a-file">Get list of signatures from a file<a class="headerlink" href="#get-list-of-signatures-from-a-file" title="Permanent link">&para;</a></h5>
<p>List signatures of <code>shimx64.efi</code>:</p>
<ul>
<li><code>pesign -S -i /usr/lib/shim/shimx64.efi.signed</code> (install via <code>sudo apt install pesign</code>)</li>
<li><code>sbverify --list sec_out/shimx64.efi.dualsigned.byme</code></li>
</ul>
<p>See who signed your files (if you are still not using fish shell, replace brackets: () with backticks: `` below):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">fish shell</label><label for="__tabbed_3_2">bash shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nv">$ </span><span class="k">echo</span> <span class="o">(</span>sudo find /boot -maxdepth <span class="m">1</span> -type f -iname <span class="s1">&#39;vmlinuz*generic&#39;</span> <span class="o">&amp;&amp;</span> sudo find /boot/efi/ -type f -iname <span class="s1">&#39;*.efi&#39;</span><span class="o">)</span> <span class="o">|</span> tr <span class="s1">&#39; &#39;</span> <span class="s1">&#39;\n&#39;</span> <span class="o">|</span> xargs -I <span class="err">{}</span> sudo bash -c <span class="s2">&quot;echo {}; pesign -S -i {} | grep \&quot;common name\&quot;&quot;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>/boot/vmlinuz-5.11.0-14-generic
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="s1">/boot/vmlinuz-5.11.0-16-generic</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="s1">The signer&#39;</span>s common name is Canonical Ltd. Secure Boot Signing <span class="o">(</span>2017<span class="o">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>/boot/efi/EFI/ubuntu/grubx64.efi
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="s1">/boot/efi/EFI/ubuntu/shimx64.efi</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="s1">The signer&#39;</span>s common name is Microsoft Windows UEFI Driver Publisher
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>/boot/efi/EFI/ubuntu/mmx64.efi
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="s1">/boot/efi/EFI/BOOT/BOOTX64.EFI</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="s1">The signer&#39;</span>s common name is Microsoft Windows UEFI Driver Publisher <span class="c"># (1)!</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>/boot/efi/EFI/BOOT/fbx64.efi
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="s1">/boot/efi/EFI/BOOT/mmx64.efi</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="s1">The signer&#39;</span>s common name is Canonical Ltd. Secure Boot Signing <span class="o">(</span>2017<span class="o">)</span>
</code></pre></div>
<ol>
<li><img alt="❗" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2757.svg" title=":exclamation:" /> note that shim is signed by M$ <img alt="❗" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2757.svg" title=":exclamation:" /></li>
</ol>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nv">$ </span><span class="k">echo</span> <span class="err">`</span>sudo find /boot -maxdepth <span class="m">1</span> -type f -iname <span class="s1">&#39;vmlinuz*generic&#39;</span> <span class="o">&amp;&amp;</span> sudo find /boot/efi/ -type f -iname <span class="s1">&#39;*.efi&#39;</span><span class="err">`</span> <span class="o">|</span> tr <span class="s1">&#39; &#39;</span> <span class="s1">&#39;\n&#39;</span> <span class="o">|</span> xargs -I <span class="err">{}</span> sudo bash -c <span class="s2">&quot;echo {}; pesign -S -i {} | grep \&quot;common name\&quot;&quot;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>/boot/vmlinuz-5.11.0-14-generic
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="s1">/boot/vmlinuz-5.11.0-16-generic</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="s1">The signer&#39;</span>s common name is Canonical Ltd. Secure Boot Signing <span class="o">(</span>2017<span class="o">)</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>/boot/efi/EFI/ubuntu/grubx64.efi
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="s1">/boot/efi/EFI/ubuntu/shimx64.efi</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="s1">The signer&#39;</span>s common name is Microsoft Windows UEFI Driver Publisher
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>/boot/efi/EFI/ubuntu/mmx64.efi
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="s1">/boot/efi/EFI/BOOT/BOOTX64.EFI</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="s1">The signer&#39;</span>s common name is Microsoft Windows UEFI Driver Publisher <span class="c"># (1)!</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>/boot/efi/EFI/BOOT/fbx64.efi
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>The signer<span class="s1">&#39;s common name is Canonical Ltd. Secure Boot Signing (2017)</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="s1">/boot/efi/EFI/BOOT/mmx64.efi</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="s1">The signer&#39;</span>s common name is Canonical Ltd. Secure Boot Signing <span class="o">(</span>2017<span class="o">)</span>
</code></pre></div>
<ol>
<li><img alt="❗" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2757.svg" title=":exclamation:" /> note that shim is signed by M$ <img alt="❗" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/2757.svg" title=":exclamation:" /></li>
</ol>
</div>
</div>
</div>
<h5 id="remove-signatures">Remove signatures<a class="headerlink" href="#remove-signatures" title="Permanent link">&para;</a></h5>
<p>It is useful if you want to sign an executable yourself and you have only signed version of it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>pesign<span class="w"> </span>--signature-number<span class="w"> </span><span class="m">0</span><span class="w"> </span>--remove-signature<span class="w"> </span>-i<span class="w"> </span>shimx64.efi<span class="w"> </span>-o<span class="w"> </span>shimx64.efi
</code></pre></div>
<h5 id="sign">Sign<a class="headerlink" href="#sign" title="Permanent link">&para;</a></h5>
<ul>
<li>Signing EFI executables (bootloaders) with keys on FS  using <code>sbsign</code> from <code>sbsigntool</code>:<ul>
<li><code>sbsign --key sec_out/KEK.key --cert sec_out/KEK.crt sec_out/shimx64.efi.dualsigned</code></li>
</ul>
</li>
<li>Signing with Yubikey. See <a href="https://developers.yubico.com/yubico-piv-tool/Actions/signing.html">here</a>.</li>
<li>Signing kernel modules using <code>kmodsign</code>:<ul>
<li><code>kmodsign sha512 DBK.key DBK.der antimalware.ko</code></li>
</ul>
</li>
</ul>
<h5 id="verify">Verify<a class="headerlink" href="#verify" title="Permanent link">&para;</a></h5>
<p>You can verify signed file by:</p>
<ul>
<li>inspecting list of signatures attached, see above</li>
<li>or by verifying against the certificate: <code>sbverify --cert sec_out/KEK.crt sec_out/shimx64.efi.dualsigned.byme</code></li>
</ul>
<h3 id="hashes"><strong>Hashes</strong><a class="headerlink" href="#hashes" title="Permanent link">&para;</a></h3>
<p>Whitelist of checksums</p>
<ul>
<li>
<p>Get the list: <code>mokutil --db</code></p>
</li>
<li>
<p>Add: <code>mokutil --import-hash(?)</code></p>
</li>
<li>
<p>Delete: <code>mokutil --delete-hash(?)</code></p>
</li>
</ul>
<p>Blacklist of checksums</p>
<ul>
<li>
<p>Get the list: <code>mokutil --dbx</code></p>
</li>
<li>
<p><code>kmodsign</code> - signs a module.</p>
</li>
</ul>
<h3 id="grub_1"><strong>GRUB</strong><a class="headerlink" href="#grub_1" title="Permanent link">&para;</a></h3>
<h5 id="protecting-grub-configs-on-disk">Protecting GRUB configs on disk<a class="headerlink" href="#protecting-grub-configs-on-disk" title="Permanent link">&para;</a></h5>
<p>In order to protect GRUB&rsquo;s config from tampering we create a standalone version of GRUB:</p>
<p><code class="highlight">grub-mkstandalone<span class="w"> </span>-d<span class="w"> </span>/usr/lib/grub/x86_64-efi/<span class="w"> </span>-O<span class="w"> </span>x86_64-efi<span class="w"> </span>--modules<span class="o">=</span><span class="s2">&quot;part_gpt part_msdos&quot;</span><span class="w"> </span>--fonts<span class="o">=</span><span class="s2">&quot;unicode&quot;</span><span class="w"> </span>--locales<span class="o">=</span><span class="s2">&quot;en@quot&quot;</span><span class="w"> </span>--themes<span class="o">=</span><span class="s2">&quot;&quot;</span><span class="w">  </span>-o<span class="w"> </span><span class="s2">&quot;/home/user/grub-standalone.efi&quot;</span><span class="w"> </span><span class="s2">&quot;boot/grub/grub.cfg=/boot/grub/grub.cfg&quot;</span></code>.</p>
<p>The resulting standalone GRUB binary is directly bootable and contains a memdisk, which holds the configuration
file and modules, as well as the configuration file. Note, it still requires <code>shim</code>, so you cannot remove everything
from <code>/boot/efi</code> except from <code>grub-standalone.efi</code>.</p>
<p>This GRUB binary now can be signed and used to boot the system.</p>
<h5 id="protecting-grub-configs-from-within-grub">Protecting GRUB configs from within GRUB<a class="headerlink" href="#protecting-grub-configs-from-within-grub" title="Permanent link">&para;</a></h5>
<p>There is GRUB shell as well as an option to modify settings from GRUB itself. To prevent a malicious user from modifying the
kernel cmdline of your system (for example, to point to a different init binary), a GRUB password should be set.</p>
<ul>
<li>
<p><code>grub-mkpasswd-pbkdf2</code> &mdash; generate hashed version of the password</p>
</li>
<li>
<p>We add this in its config:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">/etc/grub.d/40_custom</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="nb">set</span><span class="w"> </span><span class="nv">superusers</span><span class="o">=</span><span class="s2">&quot;root&quot;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>password_pbkdf2<span class="w"> </span>root<span class="w"> </span>&lt;generated<span class="w"> </span>password<span class="w"> </span>hash&gt;
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>Remove the requirement for the superuser password to be entered on a normal boot-up:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">/etc/grub.d/10-linux</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;menuentry &#39;</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$title</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grub_quote<span class="k">)</span><span class="s2">&#39;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="s2">    </span><span class="si">${</span><span class="nv">CLASS</span><span class="si">}</span><span class="s2"> \$menuentry_id_option</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="s2">    &#39;gnulinux-</span><span class="nv">$version</span><span class="s2">-</span><span class="nv">$type</span><span class="s2">-</span><span class="nv">$boot_device_id</span><span class="s2">&#39;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="s2">    --unrestricted            ### &lt;--- Add this option</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="s2">    {&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s2">&quot;s/^/</span><span class="nv">$submenu_indentation</span><span class="s2">/&quot;</span>
</code></pre></div></td></tr></table></div>
</li>
</ul>
<hr />
<h2 id="step-by-step-instructions"><strong>Step-by-step instructions</strong><a class="headerlink" href="#step-by-step-instructions" title="Permanent link">&para;</a></h2>
<p>First of all, you need to:</p>
<ul>
<li>choose how your system will boot: (1) via shim -&gt; grub -&gt; (grub.cfg, initrd, kernel) or (2) unified kernel directly.</li>
<li>choose where you will store keys: filesystem or Yubikey.</li>
</ul>
<p>We are going to use <a href="https://github.com/DimanNe/secure-boot/blob/master/secboot.py">the helper script</a>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>$ ./secboot.py
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>usage: secboot.py [-h] [--dry-run] [--log-level {DEBUG,INFO,ERROR,DISABLED}] [--run-tests]
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>                  [--no-run-tests]
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>This is a script for managing Secure boot. Many operations require root. Commands below with prefix
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>&quot;ot/&quot; (stands for &quot;one-time&quot;) are supposed to be run once, during initial setup.
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    ot/generate-gpg-keys
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>                        Generates new GPG keys. Example of usage: &quot;./secboot.py --log-level INFO
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>                        ot/generate-gpg-keys --GNUPGHOME sec_out/gpg --id Popl --gpg/pass &quot;&quot;&quot;
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>    ot/generate-uefi-keys
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>                        Generates new (your own!) UEFI (PK/KEK/db) keys and certificates on filesystem.
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>                        You might want to create a temporary memory-backed fs for the task: &quot;sudo mount
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>                        -t tmpfs -o size=10G,uid=(id -u) tmpfs sec_out&quot; and move them then to a
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>                        Yubikey, see ot/enroll-ssl-to-yubikey. Example of usage: &quot;./secboot.py --log-
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>                        level INFO ot/generate-uefi-keys -o sec_out/ --id Popl&quot;
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>    ot/enroll-ssl-to-yubikey
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>                        Enrolls PK/KEK/DB keys and certificates to Yubikey. Example of usage:
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>                        &quot;./secboot.py --log-level INFO ot/enroll-ssl-to-yubikey --keys-dir sec_out/
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>                        --uefi/nfc-reader &quot;HID Global OMNIKEY 5422 Smartcard Reader [OMNIKEY 5422CL&quot;&quot;
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    ot/enroll-certs-to-uefi
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>                        Enrolls PK/KEK/DB certificates to UEFI. Assumes that UEFI is in &quot;Setup Mode&quot;
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>                        (temporarily disable secure boot, and delete all preexisting certificates).
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>                        Example of usage: &quot;./secboot.py --log-level INFO ot/enroll-certs-to-uefi
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a>                        --uefi/engine fs --uefi/keys-dir sec_out/&quot; or &quot;./secboot.py --log-level INFO
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a>                        ot/enroll-certs-to-uefi --uefi/engine yu --uefi/nfc-reader &quot;HID Global OMNIKEY
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>                        5422 Smartcard Reader [OMNIKEY 5422CL&quot;&quot;
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a>    re-sign-efi-file    [The command is not supposed to be used on its own. You can skip it.] Removes
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>                        all existing signatures from a given EFI executable file and signs it with a
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a>                        provided (your own!) certificate. Example of usage: &quot;./secboot.py --log-level
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a>                        INFO re-sign-efi-file --file-to-sign sec_out/shimx64.efi.signed --uefi/engine
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a>                        fs --uefi/keys-dir sec_out/&quot; or &quot;./secboot.py --log-level INFO re-sign-efi-file
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>                        --file-to-sign sec_out/shimx64.efi.signed --uefi/engine yu --uefi/nfc-reader
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a>                        &quot;HID Global OMNIKEY 5422 Smartcard Reader [OMNIKEY 5422CL&quot;&quot;
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>    re-sign-file-with-gpg
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a>                        [The command is not supposed to be used on its own. You can skip it.] Produces
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a>                        a detached GPG signature using GPG. The command can be useful if you wish to
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a>                        make manual changes to grub.cfg and then re-sign it. Example of usage:
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a>                        &quot;./secboot.py --log-level INFO re-sign-file-with-gpg --file-to-sign
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a>                        sec_out/shimx64.efi --gpg/engine fs --gpg/key-id ADDB2... --GNUPGHOME
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a>                        sec_out/gpg&quot; or &quot;./secboot.py --log-level INFO re-sign-file-with-gpg --file-to-
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a>                        sign sec_out/shimx64.efi --gpg/engine yu --gpg/pub-key ~/devel/gpg*&quot;
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a>    danger/grub/make-new-boot
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a>                        Prepares new content of /boot/efi. For testing, you might want to specify &quot;--
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a>                        boot-dir ./testing-boot&quot;. Example of usage: &quot;sudo ./secboot.py --log-level INFO
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a>                        danger/grub/make-new-boot --boot-dir /boot --uefi/engine fs --uefi/keys-dir
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a>                        sec_out/ --gpg/engine fs --gpg/key-id ADDB2... --GNUPGHOME sec_out/gpg
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a>                        --gpg/pass &quot;&quot; --pbkdf-grub-pass-path ~/grub_pbkdf2_pass&quot; or &quot;sudo ./secboot.py
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a>                        --log-level INFO danger/grub/make-new-boot --boot-dir /boot --uefi/engine yu
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a>                        --uefi/nfc-reader &quot;HID Global OMNIKEY 5422 Smartcard Reader [OMNIKEY 5422CL&quot;
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a>                        --gpg/engine yu --gpg/pub-key ~/devel/gpg* --pbkdf-grub-pass-path
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a>                        ~/grub_pbkdf2_pass&quot;
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a>    danger/efistub/make-new-boot
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a>                        Prepares new content of /boot/efi. For testing, you might want to specify &quot;--
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a>                        boot-dir ./testing-boot&quot;. Example of usage: &quot;sudo ./secboot.py --log-level INFO
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a>                        danger/efistub/make-new-boot --boot-dir /boot --disk /dev/nvme0n1 --partition 1
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a>                        --uefi/engine fs --uefi/keys-dir sec_out/&quot; or &quot;sudo ./secboot.py --log-level
<a id="__codelineno-7-58" name="__codelineno-7-58" href="#__codelineno-7-58"></a>                        INFO danger/efistub/make-new-boot --boot-dir /boot --disk /dev/nvme0n1
<a id="__codelineno-7-59" name="__codelineno-7-59" href="#__codelineno-7-59"></a>                        --partition 1 --uefi/engine yu --uefi/nfc-reader &quot;HID Global OMNIKEY 5422
<a id="__codelineno-7-60" name="__codelineno-7-60" href="#__codelineno-7-60"></a>                        Smartcard Reader [OMNIKEY 5422CL&quot;&quot;
<a id="__codelineno-7-61" name="__codelineno-7-61" href="#__codelineno-7-61"></a>    qemu/efistub/initialise
<a id="__codelineno-7-62" name="__codelineno-7-62" href="#__codelineno-7-62"></a>                        Guides you through the process of (1) creation of a new VM in QEMU and (2)
<a id="__codelineno-7-63" name="__codelineno-7-63" href="#__codelineno-7-63"></a>                        making it interactable from host console. After this is done, it uses the VM
<a id="__codelineno-7-64" name="__codelineno-7-64" href="#__codelineno-7-64"></a>                        for testing itself: it (a) copies itself in the VM, (b) generates SSL/UEFI keys
<a id="__codelineno-7-65" name="__codelineno-7-65" href="#__codelineno-7-65"></a>                        using ot/generate-uefi-keys, (c) creates new boot via danger/efistub/make-new-
<a id="__codelineno-7-66" name="__codelineno-7-66" href="#__codelineno-7-66"></a>                        boot and finally (d) ensures the VM can successfully reboot. See also
<a id="__codelineno-7-67" name="__codelineno-7-67" href="#__codelineno-7-67"></a>                        qemu/efistub/run-tests. Example of usage: ./secboot.py --log-level INFO
<a id="__codelineno-7-68" name="__codelineno-7-68" href="#__codelineno-7-68"></a>                        qemu/efistub/initialise --vm-dir ~/devel/secboot_efistub_testing
<a id="__codelineno-7-69" name="__codelineno-7-69" href="#__codelineno-7-69"></a>    qemu/efistub/run-tests
<a id="__codelineno-7-70" name="__codelineno-7-70" href="#__codelineno-7-70"></a>                        Runs &quot;integration&quot; tests in QEMU VM. The tests verify that (1) the OS loads
<a id="__codelineno-7-71" name="__codelineno-7-71" href="#__codelineno-7-71"></a>                        after all modifications, (2) the OS does NOT load if anything (unified kernel
<a id="__codelineno-7-72" name="__codelineno-7-72" href="#__codelineno-7-72"></a>                        image) was changed. Example of usage: &quot;./secboot.py --log-level INFO
<a id="__codelineno-7-73" name="__codelineno-7-73" href="#__codelineno-7-73"></a>                        qemu/efistub/run-tests --vm-dir ~/devel/secboot_efistub_testing&quot;
<a id="__codelineno-7-74" name="__codelineno-7-74" href="#__codelineno-7-74"></a>    qemu/grub/initialise
<a id="__codelineno-7-75" name="__codelineno-7-75" href="#__codelineno-7-75"></a>                        Guides you through the process of (1) creation of a new VM in QEMU and (2)
<a id="__codelineno-7-76" name="__codelineno-7-76" href="#__codelineno-7-76"></a>                        making it interactable from host console. After this is done, it uses the VM
<a id="__codelineno-7-77" name="__codelineno-7-77" href="#__codelineno-7-77"></a>                        for testing itself: it (a) copies itself in the VM, (b) generates GPG keys in
<a id="__codelineno-7-78" name="__codelineno-7-78" href="#__codelineno-7-78"></a>                        the VM using ot/generate-gpg-keys, (c) generates SSL/UEFI keys using
<a id="__codelineno-7-79" name="__codelineno-7-79" href="#__codelineno-7-79"></a>                        ot/generate-uefi-keys, (d) creates new boot via danger/grub/make-new-boot and
<a id="__codelineno-7-80" name="__codelineno-7-80" href="#__codelineno-7-80"></a>                        finally (d) ensures the VM can successfully reboot. See also qemu/grub/run-
<a id="__codelineno-7-81" name="__codelineno-7-81" href="#__codelineno-7-81"></a>                        tests. Example of usage: ./secboot.py --log-level INFO qemu/grub/initialise
<a id="__codelineno-7-82" name="__codelineno-7-82" href="#__codelineno-7-82"></a>                        --vm-dir ~/devel/secboot_grub_testing
<a id="__codelineno-7-83" name="__codelineno-7-83" href="#__codelineno-7-83"></a>    qemu/grub/run-tests
<a id="__codelineno-7-84" name="__codelineno-7-84" href="#__codelineno-7-84"></a>                        Runs &quot;integration&quot; tests in QEMU VM. The tests verify that (1) the OS loads
<a id="__codelineno-7-85" name="__codelineno-7-85" href="#__codelineno-7-85"></a>                        after all modifications, (2) the OS does NOT load if anything (kernel, initrd,
<a id="__codelineno-7-86" name="__codelineno-7-86" href="#__codelineno-7-86"></a>                        GRUB, GRUB config, shim) was changed. Example of usage: &quot;./secboot.py --log-
<a id="__codelineno-7-87" name="__codelineno-7-87" href="#__codelineno-7-87"></a>                        level INFO qemu/grub/run-tests --vm-dir ~/devel/secboot_grub_testing&quot;
<a id="__codelineno-7-88" name="__codelineno-7-88" href="#__codelineno-7-88"></a>
<a id="__codelineno-7-89" name="__codelineno-7-89" href="#__codelineno-7-89"></a>optional arguments:
<a id="__codelineno-7-90" name="__codelineno-7-90" href="#__codelineno-7-90"></a>  -h, --help            show this help message and exit
<a id="__codelineno-7-91" name="__codelineno-7-91" href="#__codelineno-7-91"></a>  --dry-run
<a id="__codelineno-7-92" name="__codelineno-7-92" href="#__codelineno-7-92"></a>  --log-level {DEBUG,INFO,ERROR,DISABLED}
<a id="__codelineno-7-93" name="__codelineno-7-93" href="#__codelineno-7-93"></a>                        Log level
<a id="__codelineno-7-94" name="__codelineno-7-94" href="#__codelineno-7-94"></a>  --run-tests
<a id="__codelineno-7-95" name="__codelineno-7-95" href="#__codelineno-7-95"></a>  --no-run-tests
</code></pre></div>
<p>Its output is pretty self-explanatory. If you need more details specify <code>--log-level DEBUG</code>, <code>--dry-run</code> is also supported.
Also, you might want to check help of specific sub-commands, for example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>./secboot.py --log-level INFO danger/grub/make-new-boot --help
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>usage: secboot.py danger/grub/make-new-boot [-h] [--boot-dir BOOT_DIR] [--work-dir WORK_DIR]
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>                                            [--backups-dir BACKUPS_DIR] --pbkdf-grub-pass-path
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>                                            PBKDF_GRUB_PASS_PATH --uefi/engine {fs,yu}
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>                                            [--uefi/key {KEK,db}] [--uefi/keys-dir UEFI/KEYS_DIR]
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>                                            [--uefi/pass UEFI/PASS] [--uefi/nfc-reader UEFI/NFC_READER]
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>                                            --gpg/engine {fs,yu} [--gpg/pub-key GPG/PUB_KEY]
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>                                            [--gpg/key-id GPG/KEY_ID] [--GNUPGHOME GNUPGHOME]
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>                                            [--use-gpg-agent-for-pass] [--gpg/pass GPG/PASS]
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>optional arguments:
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>  -h, --help            show this help message and exit
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>  --boot-dir BOOT_DIR   Boot dir.
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>  --work-dir WORK_DIR   Work dir.
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>  --backups-dir BACKUPS_DIR
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>                        Directory where to backup existing boot
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>  --uefi/engine {fs,yu}
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>                        Defines source of key info: &quot;fs&quot; - a directory on filesystem, &quot;yu&quot; - Yubikey
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a>  --uefi/nfc-reader UEFI/NFC_READER
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>                        (Only if &quot;yu&quot; engine is used and only if it is used over NFC interface.) An
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a>                        id(or a prefix thereof) of NFC reader. It is needed for Yubikey soft to be able
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a>                        to correctly talk to Yubikey. You can obtain one by running: &quot;yubico-piv-tool
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>                        -a status -v2&quot;, see more info here https://github.com/Yubico/yubico-piv-
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a>                        tool/issues/298
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>  --gpg/engine {fs,yu}  Defines source of key info: &quot;fs&quot; - a directory on filesystem, &quot;yu&quot; - Yubikey
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>  --gpg/pub-key GPG/PUB_KEY
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a>                        (Only if &quot;yu&quot; engine is used) Path to a public GPG key
</code></pre></div>
<h3 id="buy-equipment"><strong>Buy equipment</strong><a class="headerlink" href="#buy-equipment" title="Permanent link">&para;</a></h3>
<p>Storing your keys in Yubikey has a number of advantages:</p>
<ul>
<li>Keys are never stored on filesystem of your PC.</li>
<li>It is <a href="https://security.stackexchange.com/a/93415/231470">nearly impossible</a> to extract (private) keys from Yubikey
  (and impossible without your noticing it).</li>
<li>Yubikey has a hardware-backed max PIN entry counter (for example, your LUKS password can be brute-forced arbitrarily
  long, but Yubikey limits the number of attempts to 3).</li>
<li>Yubikey can be hideen/stored in a safe place.</li>
<li>You do not need to insert it physically in a USB because there are NFC versions.</li>
</ul>
<p>So, you might want to buy <a href="https://www.yubico.com/gb/product/yubikey-5c-nfc/">Yubikey NFC</a> as well as NFC reader: something
like <a href="https://www.amazon.co.uk/gp/product/B0777RCP1C/ref=ppx_yo_dt_b_asin_title_o06_s00?ie=UTF8&amp;psc=1">HID Identity OMNIKEY 5422</a>
will work, while NFC ACR122 ACR122U will NOT because it does not support &ldquo;extended APDU&rdquo; / &ldquo;TPDU&rdquo;.</p>
<h3 id="generate-ssluefi-keys-and-certificates"><strong>Generate SSL/UEFI keys and certificates</strong><a class="headerlink" href="#generate-ssluefi-keys-and-certificates" title="Permanent link">&para;</a></h3>
<p>This will genrate (PK, KEK, db) x (cer, key) in a directory (<code>sec_out</code> in the example below):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>$<span class="w"> </span>./secboot.py<span class="w"> </span>--log-level<span class="w"> </span>INFO<span class="w"> </span>ot/generate-uefi-keys<span class="w"> </span>-o<span class="w"> </span>sec_out/<span class="w"> </span>--id<span class="w"> </span>Popl
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:00:10,939<span class="w"> </span>INFO<span class="w"> </span>generate:370:<span class="w"> </span>Generated<span class="w"> </span>private<span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>sec_out/PK.key,<span class="w"> </span>cert<span class="w"> </span><span class="k">in</span><span class="w"> </span>sec_out/PK.crt.<span class="w"> </span>You<span class="w"> </span>might<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>check<span class="w"> </span>that<span class="w"> </span>everything<span class="w"> </span>is<span class="w"> </span>fine:<span class="w"> </span><span class="s2">&quot;openssl x509 -inform pem -in sec_out/PK.crt -text&quot;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:00:11,043<span class="w"> </span>INFO<span class="w"> </span>generate:378:<span class="w"> </span>Converted<span class="w"> </span>PEM-encoded<span class="w"> </span>.crt<span class="w"> </span>to<span class="w"> </span>DER-encoded<span class="w"> </span>.cer<span class="w"> </span>at:<span class="w"> </span>sec_out/PK.cer
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:00:11,201<span class="w"> </span>INFO<span class="w"> </span>generate:370:<span class="w"> </span>Generated<span class="w"> </span>private<span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>sec_out/KEK.key,<span class="w"> </span>cert<span class="w"> </span><span class="k">in</span><span class="w"> </span>sec_out/KEK.crt.<span class="w"> </span>You<span class="w"> </span>might<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>check<span class="w"> </span>that<span class="w"> </span>everything<span class="w"> </span>is<span class="w"> </span>fine:<span class="w"> </span><span class="s2">&quot;openssl x509 -inform pem -in sec_out/KEK.crt -text&quot;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:00:11,304<span class="w"> </span>INFO<span class="w"> </span>generate:378:<span class="w"> </span>Converted<span class="w"> </span>PEM-encoded<span class="w"> </span>.crt<span class="w"> </span>to<span class="w"> </span>DER-encoded<span class="w"> </span>.cer<span class="w"> </span>at:<span class="w"> </span>sec_out/KEK.cer
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:00:11,455<span class="w"> </span>INFO<span class="w"> </span>generate:370:<span class="w"> </span>Generated<span class="w"> </span>private<span class="w"> </span>key<span class="w"> </span><span class="k">in</span><span class="w"> </span>sec_out/db.key,<span class="w"> </span>cert<span class="w"> </span><span class="k">in</span><span class="w"> </span>sec_out/db.crt.<span class="w"> </span>You<span class="w"> </span>might<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>check<span class="w"> </span>that<span class="w"> </span>everything<span class="w"> </span>is<span class="w"> </span>fine:<span class="w"> </span><span class="s2">&quot;openssl x509 -inform pem -in sec_out/db.crt -text&quot;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:00:11,558<span class="w"> </span>INFO<span class="w"> </span>generate:378:<span class="w"> </span>Converted<span class="w"> </span>PEM-encoded<span class="w"> </span>.crt<span class="w"> </span>to<span class="w"> </span>DER-encoded<span class="w"> </span>.cer<span class="w"> </span>at:<span class="w"> </span>sec_out/db.cer
</code></pre></div>
<p>If you have a Yubikey, move keys to it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>$<span class="w"> </span>./secboot.py<span class="w"> </span>--log-level<span class="w"> </span>INFO<span class="w"> </span>ot/enroll-ssl-to-yubikey<span class="w"> </span>--keys-dir<span class="w"> </span>sec_out/<span class="w"> </span>--uefi/nfc-reader<span class="w"> </span><span class="s2">&quot;HID Global OMNIKEY 5422 Smartcard Reader [OMNIKEY 5422CL&quot;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:00,161<span class="w"> </span>WARNING<span class="w"> </span>enroll_to_yubikey:470:<span class="w"> </span>You<span class="w"> </span>might<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>setup<span class="w"> </span>your<span class="w"> </span>Yubikey:<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>Set<span class="w"> </span>PIN:<span class="w"> </span><span class="s2">&quot;yubico-piv-tool -r &#39;HID Global OMNIKEY 5422 Smartcard Reader [OMNIKEY 5422CL&#39; --action change-pin -P 123456&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">2</span><span class="o">)</span><span class="w"> </span>Set<span class="w"> </span>PUK:<span class="w"> </span><span class="s2">&quot;yubico-piv-tool -r &#39;HID Global OMNIKEY 5422 Smartcard Reader [OMNIKEY 5422CL&#39; --action change-puk -P 12345678&quot;</span>,<span class="w"> </span><span class="o">(</span><span class="m">3</span><span class="o">)</span><span class="w"> </span>Enable<span class="w"> </span>PIV<span class="w"> </span>over<span class="w"> </span>NFC:<span class="w"> </span><span class="s2">&quot;ykman config nfc -f -e PIV&quot;</span>.<span class="w"> </span>Other<span class="w"> </span>action<span class="w"> </span>see<span class="w"> </span>here:<span class="w"> </span>https://developers.yubico.com/yubico-piv-tool/Actions/
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:00,655<span class="w"> </span>INFO<span class="w"> </span>enable_retired_slots:483:<span class="w"> </span>Retired<span class="w"> </span>slots<span class="w"> </span>enabled
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:00,843<span class="w"> </span>INFO<span class="w"> </span>enroll:496:<span class="w"> </span>Added<span class="w"> </span>key:<span class="w"> </span>sec_out/PK.key<span class="w"> </span><span class="k">in</span><span class="w"> </span>slot:<span class="w"> </span><span class="m">82</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:01,060<span class="w"> </span>INFO<span class="w"> </span>enroll:502:<span class="w"> </span>Added<span class="w"> </span>certificate:<span class="w"> </span>sec_out/PK.crt<span class="w"> </span><span class="k">in</span><span class="w"> </span>slot:<span class="w"> </span><span class="m">82</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:01,246<span class="w"> </span>INFO<span class="w"> </span>enroll:496:<span class="w"> </span>Added<span class="w"> </span>key:<span class="w"> </span>sec_out/KEK.key<span class="w"> </span><span class="k">in</span><span class="w"> </span>slot:<span class="w"> </span>9d
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:01,463<span class="w"> </span>INFO<span class="w"> </span>enroll:502:<span class="w"> </span>Added<span class="w"> </span>certificate:<span class="w"> </span>sec_out/KEK.crt<span class="w"> </span><span class="k">in</span><span class="w"> </span>slot:<span class="w"> </span>9d
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:01,651<span class="w"> </span>INFO<span class="w"> </span>enroll:496:<span class="w"> </span>Added<span class="w"> </span>key:<span class="w"> </span>sec_out/db.key<span class="w"> </span><span class="k">in</span><span class="w"> </span>slot:<span class="w"> </span>9c
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="m">2021</span>-04-27<span class="w"> </span><span class="m">09</span>:18:01,867<span class="w"> </span>INFO<span class="w"> </span>enroll:502:<span class="w"> </span>Added<span class="w"> </span>certificate:<span class="w"> </span>sec_out/db.crt<span class="w"> </span><span class="k">in</span><span class="w"> </span>slot:<span class="w"> </span>9c
</code></pre></div>
<p>Refer to help of &ldquo;<code>ot/enroll-ssl-to-yubikey</code>&rdquo; to get more info about <code>--uefi/nfc-reader</code> option and its value.</p>
<h3 id="for-grub-users"><strong>For GRUB users</strong><a class="headerlink" href="#for-grub-users" title="Permanent link">&para;</a></h3>
<h5 id="generate-gpg-keys">Generate GPG keys<a class="headerlink" href="#generate-gpg-keys" title="Permanent link">&para;</a></h5>
<p>The best guide for generating GPG keys and enrolling them to Yubikey is <a href="https://github.com/drduh/YubiKey-Guide">here</a>.
But the script also can generate them:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>./secboot.py --log-level INFO ot/generate-gpg-keys --GNUPGHOME sec_out/gpg1 --id Popl --gpg/pass &quot;&quot;
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>2021-05-01 19:46:31,582 INFO generate_keys:818: Generated primary rsa4096 cert key with keyid: C16D9DAAE7E7CF8667EBF64CE18101E9A3EAB78F
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>2021-05-01 19:46:32,269 INFO add_sub_key:826: Generated sub-key: rsa4096 sign
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>2021-05-01 19:46:32,983 INFO add_sub_key:826: Generated sub-key: rsa4096 encrypt
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>2021-05-01 19:46:34,425 INFO add_sub_key:826: Generated sub-key: rsa4096 auth
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>Done
</code></pre></div>
<p>Refer to the <a href="https://github.com/drduh/YubiKey-Guide">guide</a> if you have a Yubikey and wish to move the key to it (note, it will
remove keys on filesystem). In short:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>gpg --edit-key $KEYID
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>   key 1
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>   keytocard
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>   key 1
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>   key 2
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>   keytocard
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>   key 2
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>   key 3
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>   keytocard
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>   key 3
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>   save
</code></pre></div>
<h5 id="grub-password-hash">GRUB password hash<a class="headerlink" href="#grub-password-hash" title="Permanent link">&para;</a></h5>
<p>As described above, various advanced options (such as rescue shell) must be protected with GRUB&rsquo;s superuser+password.
The script creates GRUB config with username <code>root</code>. But you will need to come up with a password and create a file
containing pbkdf2 hash of it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>$<span class="w"> </span>grub-mkpasswd-pbkdf2<span class="w"> </span>-c<span class="w"> </span><span class="m">50000000</span><span class="w"> </span><span class="c1"># (1)!</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>Enter<span class="w"> </span>password:<span class="w"> </span>&lt;test&gt;
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>Reenter<span class="w"> </span>password:<span class="w"> </span>&lt;test&gt;
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>PBKDF2<span class="w"> </span><span class="nb">hash</span><span class="w"> </span>of<span class="w"> </span>your<span class="w"> </span>password<span class="w"> </span>is<span class="w"> </span>grub.pbkdf2.sha512.10000.ED9363D6FFDC719D047BC8B4544DC36001DE400D26E2E040613D7503BBE80EE5C14FB39535BD7DBAB95851A612EC49F3A8213B57EE1C27B7DC34DE1ABF79E502.327C2AB81E227E26D11DE8D291DFFEFC026339F51FF46EE321F57B2D3397788E55C3D144F5BCA13BAE0AB01B2C28D28B8B8E2EACE8E70BF58466B7A5F03CC137
</code></pre></div>
<ol>
<li><code>-c 50000000</code> means that when an adversary will brute-force your password on a huge cluster of machines,
  it will take just ~2 minutes for one try, so, feel free to <em>increase</em> the iteration count (until you feel
  comfortable with the time required for one attempt).</li>
</ol>
<p>Add the hash to a file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>echo grub.pbkdf2.sha512.10000.ED9363D6F... &gt; ~/grub_pbkdf2_pass
</code></pre></div>
<p>We will then specify the file for the script. The script will read the hash and embed it in a standalone version of GRUB,
which then will be signed with UEFI certificate.</p>
<h5 id="generate-new-boot">Generate new boot<a class="headerlink" href="#generate-new-boot" title="Permanent link">&para;</a></h5>
<p class="annotate">This is the only command that you will need to run repeatedly (potentially with each system update) (1).</p>
<ol>
<li>You can create an alias/function: <code>sysupgrade: sudo apt update &amp;&amp; sudo apt upgrade &amp;&amp; sudo ./secboot.py --log-level INFO danger/make-new-boot ...</code> to simplify the task.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$ sudo ./secboot.py --log-level INFO danger/make-new-boot \
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>                    --boot-dir /boot \
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>                    --uefi/engine fs --uefi/keys-dir sec_out/ \
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>                    --gpg/engine fs --gpg/key-id 8C0FE2CEAA13563813D6239504AF0F899E6DF636 --GNUPGHOME sec_out/gpg --gpg/pass &quot;&quot; \
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>                    --pbkdf-grub-pass-path ~/grub_pbkdf2_pass
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>2021-05-01 18:46:20,301 INFO make_new_boot:1222: Backing up /boot...
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>2021-05-01 18:46:20,301 INFO exec:82: executing: cp -r /boot /bb/boot.bak.1619891180.3016443
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>2021-05-01 18:46:20,784 INFO make_new_boot:1235: Preparing standalone GRUB, its config and signing it with GPG...
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>2021-05-01 18:46:21,080 INFO _create_trampoline_config:1099: Created grub trampoline config at: /tmp/secboot_eex1v1g3/grub.init.cfg
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>2021-05-01 18:46:21,422 INFO create_standalone_and_config:1193: Signed grub trampoline config. Signature: /tmp/secboot_eex1v1g3/grub.init.cfg.sig, you can verify it yourself: &quot;gpg --verify /tmp/secboot_eex1v1g3/grub.init.cfg.sig /tmp/secboot_eex1v1g3/grub.init.cfg&quot;
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>2021-05-01 18:46:21,848 INFO _create_standalone:1120: Created standalone grub EFI binary at: /tmp/secboot_eex1v1g3/grubx64.efi
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>2021-05-01 18:46:21,848 INFO _create_main_config:1125: Creating main GRUB config for kernels: [KernelVersion(p1=5, p2=8, p3=0, p4=50, suffix=&#39;generic&#39;), KernelVersion(p1=5, p2=8, p3=0, p4=25, suffix=&#39;generic&#39;)]...
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>2021-05-01 18:46:23,872 INFO generate_custom_menu_entries:1143: Generating menuentry for kernel version: 5.8.0-50-generic, cmdline: root=/dev/mapper/vgkubuntu-root ro console=tty0 console=ttyS0,38400n8 and OS: Ubuntu 20.10
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>2021-05-01 18:46:23,872 INFO generate_custom_menu_entries:1143: Generating menuentry for kernel version: 5.8.0-25-generic, cmdline: root=/dev/mapper/vgkubuntu-root ro console=tty0 console=ttyS0,38400n8 and OS: Ubuntu 20.10
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>2021-05-01 18:46:23,872 INFO _create_main_config:1176: Created main GRUB config at: /tmp/secboot_eex1v1g3/grub.cfg
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>2021-05-01 18:46:24,112 INFO create_standalone_and_config:1204: Signed grub main config. Signature: /tmp/secboot_eex1v1g3/grub.cfg.sig, you can verify it yourself: &quot;gpg --verify /tmp/secboot_eex1v1g3/grub.cfg.sig /tmp/secboot_eex1v1g3/grub.cfg&quot;
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>2021-05-01 18:46:24,114 INFO make_new_boot:1243: Coping results to the right place...
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>2021-05-01 18:46:24,115 INFO exec:82: executing: cp /tmp/secboot_eex1v1g3/grub.cfg /boot/efi
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>2021-05-01 18:46:24,218 INFO exec:82: executing: cp /tmp/secboot_eex1v1g3/grub.cfg.sig /boot/efi
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>2021-05-01 18:46:24,321 INFO exec:82: executing: cp /tmp/secboot_eex1v1g3/grubx64.efi /boot/efi/EFI/ubuntu/grubx64.efi
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>2021-05-01 18:46:24,429 INFO exec:82: executing: cp /boot/vmlinuz-5.8.0-50-generic /boot/efi
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>2021-05-01 18:46:24,549 INFO exec:82: executing: cp /boot/initrd.img-5.8.0-50-generic /boot/efi
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>2021-05-01 18:46:24,741 INFO exec:82: executing: cp /boot/vmlinuz-5.8.0-25-generic /boot/efi
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>2021-05-01 18:46:24,860 INFO exec:82: executing: cp /boot/initrd.img-5.8.0-25-generic /boot/efi
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>2021-05-01 18:46:25,115 INFO make_new_boot:1260: (Re-)signing all EFI binaries with SSL...
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>2021-05-01 18:46:25,219 WARNING install_if_program_does_not_exist:134: Program: pesign does not exist =&gt; installing it via package: pesign
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>2021-05-01 18:46:32,095 INFO re_sign_efi_file:626: (Re-)signed and verified /boot/efi/vmlinuz-5.8.0-50-generic with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /boot/efi/vmlinuz-5.8.0-50-generic&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /boot/efi/vmlinuz-5.8.0-50-generic&quot;
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>2021-05-01 18:46:33,276 INFO re_sign_efi_file:626: (Re-)signed and verified /boot/efi/vmlinuz-5.8.0-25-generic with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /boot/efi/vmlinuz-5.8.0-25-generic&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /boot/efi/vmlinuz-5.8.0-25-generic&quot;
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>2021-05-01 18:46:33,660 INFO re_sign_efi_file:626: (Re-)signed and verified /boot/efi/EFI/ubuntu/grubx64.efi with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /boot/efi/EFI/ubuntu/grubx64.efi&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /boot/efi/EFI/ubuntu/grubx64.efi&quot;
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>2021-05-01 18:46:34,110 INFO re_sign_efi_file:626: (Re-)signed and verified /boot/efi/EFI/ubuntu/shimx64.efi with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /boot/efi/EFI/ubuntu/shimx64.efi&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /boot/efi/EFI/ubuntu/shimx64.efi&quot;
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>2021-05-01 18:46:34,555 INFO re_sign_efi_file:626: (Re-)signed and verified /boot/efi/EFI/ubuntu/mmx64.efi with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /boot/efi/EFI/ubuntu/mmx64.efi&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /boot/efi/EFI/ubuntu/mmx64.efi&quot;
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>2021-05-01 18:46:35,007 INFO re_sign_efi_file:626: (Re-)signed and verified /boot/efi/EFI/BOOT/BOOTX64.EFI with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /boot/efi/EFI/BOOT/BOOTX64.EFI&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /boot/efi/EFI/BOOT/BOOTX64.EFI&quot;
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>2021-05-01 18:46:35,906 INFO make_new_boot:1275: (Re-)signing files with GPG...
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>2021-05-01 18:46:36,265 INFO re_sign_file_with_gpg:868: Signed and verified /boot/vmlinuz-5.8.0-50-generic with Gpg(/home/test/sec_out/gpg, key_id: 8C0FE2CEAA13563813D6239504AF0F899E6DF636). Signature: /boot/vmlinuz-5.8.0-50-generic.sig. You can verify it yourself with &quot;gpg --verify /boot/vmlinuz-5.8.0-50-generic.sig /boot/vmlinuz-5.8.0-50-generic&quot;
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>2021-05-01 18:46:37,150 INFO re_sign_file_with_gpg:868: Signed and verified /boot/initrd.img-5.8.0-50-generic with Gpg(/home/test/sec_out/gpg, key_id: 8C0FE2CEAA13563813D6239504AF0F899E6DF636). Signature: /boot/initrd.img-5.8.0-50-generic.sig. You can verify it yourself with &quot;gpg --verify /boot/initrd.img-5.8.0-50-generic.sig /boot/initrd.img-5.8.0-50-generic&quot;
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>2021-05-01 18:46:40,765 INFO make_new_boot:1284: Removing backdoor-ish MokManager...
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>2021-05-01 18:46:40,766 INFO exec:82: executing: rm /boot/efi/EFI/ubuntu/mmx64.efi
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>2021-05-01 18:46:40,869 INFO exec:82: executing: rm /boot/efi/EFI/BOOT/mmx64.efi
</code></pre></div>
<h3 id="for-efi-stub-users"><strong>For EFI Stub Users</strong><a class="headerlink" href="#for-efi-stub-users" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>$ sudo ./secboot.py --log-level INFO danger/efistub/make-new-boot \
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>                    --boot-dir /boot --disk /dev/sda --partition 1 \
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>                    --uefi/engine fs --uefi/keys-dir sec_out/
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>2021-05-04 17:46:11,174 INFO create_unified_kernel_from:1496: Creating unified kernel image from vmlinuz and initrd 5.11.0-16-generic in /boot
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>2021-05-04 17:46:11,277 WARNING install_if_program_does_not_exist:144: Program: objcopy does not exist =&gt; installing it via package: binutils
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>2021-05-04 17:46:15,764 WARNING install_if_program_does_not_exist:144: Program: pesign does not exist =&gt; installing it via package: pesign
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>2021-05-04 17:46:22,283 INFO re_sign_efi_file:636: (Re-)signed and verified /tmp/secboot_yqx1ll9c/secboot-linux-latest.efi with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /tmp/secboot_yqx1ll9c/secboot-linux-latest.efi&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /tmp/secboot_yqx1ll9c/secboot-linux-latest.efi&quot;
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>2021-05-04 17:46:22,283 INFO create_unified_kernel_from:1496: Creating unified kernel image from vmlinuz and initrd 5.8.0-50-generic in /boot
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>2021-05-04 17:46:24,581 INFO re_sign_efi_file:636: (Re-)signed and verified /tmp/secboot_yqx1ll9c/secboot-linux-prev.efi with FsUefi(/home/test/sec_out/db). You can verify it yourself with &quot;pesign -S -i /tmp/secboot_yqx1ll9c/secboot-linux-prev.efi&quot; and/or &quot;sbverify --cert /home/test/sec_out/db.crt /tmp/secboot_yqx1ll9c/secboot-linux-prev.efi&quot;
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>2021-05-04 17:46:24,581 INFO make_boot_backup:984: Backing up /boot...
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>2021-05-04 17:46:24,581 INFO exec:92: executing: cp -r /boot /bb/boot.bak.1620146784.581392
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>2021-05-04 17:46:24,944 INFO exec:92: executing: find /boot/efi -mindepth 1 ! -name &quot;*.cer&quot; -delete
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>2021-05-04 17:46:25,047 INFO exec:92: executing: mkdir -p /boot/efi
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>2021-05-04 17:46:25,150 INFO exec:92: executing: mkdir -p /boot/efi
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>2021-05-04 17:46:25,252 INFO exec:92: executing: cp /tmp/secboot_yqx1ll9c/secboot-linux-prev.efi /boot/efi/secboot-linux-prev.efi
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>2021-05-04 17:46:25,463 INFO exec:92: executing: cp /tmp/secboot_yqx1ll9c/secboot-linux-latest.efi /boot/efi/secboot-linux-latest.efi
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>2021-05-04 17:46:25,865 INFO repopulate_efibootmgr_if_needed:1522: Need to repopulate efibootmgr entries because number of entries (which is 7) is not 2
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>2021-05-04 17:46:25,866 INFO repopulate_efibootmgr_if_needed:1539: Removing boot: 0000
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a>2021-05-04 17:46:25,980 INFO repopulate_efibootmgr_if_needed:1539: Removing boot: 0001
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a>2021-05-04 17:46:26,092 INFO repopulate_efibootmgr_if_needed:1539: Removing boot: 0002
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>2021-05-04 17:46:26,205 INFO repopulate_efibootmgr_if_needed:1539: Removing boot: 0003
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a>2021-05-04 17:46:26,316 INFO repopulate_efibootmgr_if_needed:1539: Removing boot: 0004
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>2021-05-04 17:46:26,429 INFO repopulate_efibootmgr_if_needed:1539: Removing boot: 0005
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a>2021-05-04 17:46:26,540 INFO repopulate_efibootmgr_if_needed:1539: Removing boot: 0006
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a>2021-05-04 17:46:26,647 INFO add_entry:1547: Adding boot entry for &quot;SecBoot Previous Linux&quot;, /secboot-linux-prev.efi
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a>2021-05-04 17:46:26,764 INFO add_entry:1547: Adding boot entry for &quot;SecBoot Latest Linux&quot;, /secboot-linux-latest.efi
</code></pre></div>
<h3 id="enroll-your-uefi-keys"><strong>Enroll your UEFI keys</strong><a class="headerlink" href="#enroll-your-uefi-keys" title="Permanent link">&para;</a></h3>
<p>There are many ways of enrolling your keys, but since you will need to reboot your PC anyway in order to delete
existing keys from UEFI, I will consider enrolling certificates using UEFI.</p>
<h5 id="get-your-certificates">Get your certificates<a class="headerlink" href="#get-your-certificates" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>If they are on filesystem it is trivial.</p>
</li>
<li>
<p>If you moved them to a Yubikey, run this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>./secboot.py<span class="w"> </span>--log-level<span class="w"> </span>INFO<span class="w"> </span>ot/enroll-certs-to-uefi<span class="w"> </span>--uefi/engine<span class="w"> </span>yu<span class="w"> </span>--uefi/nfc-reader<span class="w"> </span><span class="s2">&quot;HID Global OMNIKEY 5422 Smartcard Reader [OMNIKEY 5422CL&quot;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>Not<span class="w"> </span>implemented<span class="w"> </span>yet.
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>You<span class="w"> </span>will<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span><span class="k">do</span><span class="w"> </span>it<span class="w"> </span>manually:
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">    </span>-<span class="w"> </span>Copy<span class="w"> </span>*.cer<span class="w"> </span>files<span class="w"> </span>from<span class="w"> </span>/tmp/secboot_certs_for_uefi_dfd29wtd<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>FAT-formatted<span class="w"> </span>flash<span class="w"> </span>drive,<span class="w"> </span>_or_<span class="w"> </span>/boot/efi<span class="w"> </span>directory
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">    </span>-<span class="w"> </span>Reboot<span class="w"> </span>and<span class="w"> </span>enter<span class="w"> </span>UEFI<span class="w"> </span><span class="nv">setup</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span>SecureBoot<span class="w"> </span>settings
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span>-<span class="w"> </span>In<span class="w"> </span>the<span class="w"> </span>settings,<span class="w"> </span>remove<span class="w"> </span>all<span class="w"> </span>existing<span class="w"> </span>keys<span class="w"> </span><span class="o">(</span>PK,<span class="w"> </span>KEK,<span class="w"> </span>db<span class="o">)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span>-<span class="w"> </span>Enroll<span class="w"> </span>your<span class="w"> </span>own<span class="w"> </span><span class="o">(</span>db.cer,<span class="w"> </span>KEK.cer,<span class="w"> </span>PK.cer<span class="o">)</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>Press<span class="w"> </span>any<span class="w"> </span>key<span class="w"> </span>to<span class="w"> </span>exit...
</code></pre></div>
<p>The command above will extract all certificates in a temporary directory and will wait until you press a key, after which it will erase the extracted certificates. So copy the certificates somewhere.</p>
</li>
</ul>
<h5 id="move-certificates-to-media-accessible-from-uefi">Move certificates to media accessible from UEFI<a class="headerlink" href="#move-certificates-to-media-accessible-from-uefi" title="Permanent link">&para;</a></h5>
<p>You have two options:</p>
<ul>
<li>
<p><span class="critic comment">Simplest</span> Copy <code>*.cer</code> files to <code>/boot/efi</code> &mdash; this is visible from UEFI.</p>
</li>
<li>
<p>Alternatively, you can create a USB flash and copy them there:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a>sudo<span class="w"> </span>parted<span class="w"> </span>/dev/sdX<span class="w"> </span>mklabel<span class="w"> </span>gpt<span class="w"> </span><span class="c1"># or msdos</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>sudo<span class="w"> </span>parted<span class="w"> </span>-a<span class="w"> </span>opt<span class="w"> </span>/dev/sdX<span class="w"> </span>mkpart<span class="w"> </span>primary<span class="w"> </span><span class="m">0</span>%<span class="w"> </span><span class="m">100</span>%
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>sudo<span class="w"> </span>mkfs.ext4<span class="w"> </span>-L<span class="w"> </span>TempStorage<span class="w"> </span>/dev/sdX1
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>sudo<span class="w"> </span>mount<span class="w"> </span>/dev/sda1<span class="w"> </span>/mnt/
</code></pre></div></td></tr></table></div>
</li>
</ul>
<h5 id="reboot-and-enroll">Reboot and enroll<a class="headerlink" href="#reboot-and-enroll" title="Permanent link">&para;</a></h5>
<p>Finally, reboot, remove all existing certificates, and enroll your own. If something goes wrong, you should be
able to fix it by disabling SecureBoot.</p>
<p>Note that you will probably need to switch Mode from &ldquo;Windows UEFI&rdquo; to &ldquo;Custom&rdquo;, otherwise, shim will not be able
to validate GRUB signed by us.</p>
<h5 id="lock-down-uefi">Lock-down UEFI<a class="headerlink" href="#lock-down-uefi" title="Permanent link">&para;</a></h5>
<p>Protect UEFI settings / certificates by setting a password. Without this step, all UEFI settings can be disabled.</p>
<p>Always prefer the thorough or full boot option when unsure of the vendor implementation.</p>
<p>Disable Compatibility Support Module (CSM) Legacy Mode to prevent legacy fallback mode from bypassing Secure Boot
protections. Reason: Some systems fall back to Legacy Mode when a Secure Boot check fails.</p>
<h3 id="reboot-and-check-it-works"><strong>Reboot and check it works</strong><a class="headerlink" href="#reboot-and-check-it-works" title="Permanent link">&para;</a></h3>
<ul>
<li>Check that secure boot is enabled: <code>sudo dmesg | grep -i "uefi\|secure boot"</code></li>
<li>Double-check that secure boot is enabled: <code>mokutil --sb-state</code></li>
<li>Triple-check that secure boot is enabled: <code>od -An -t u1 --read-bytes=1 --skip-bytes=4 /sys/firmware/efi/efivars/SecureBoot-*</code> must output <code>1</code>.</li>
<li>Check that there is only your certificates: <code>efi-readvar</code></li>
<li>Check you keys are in the output of <code>sudo cat /proc/keys</code></li>
<li>Ideally, you should check that boot will fail if you modify something (shim, grub, grub.cfg, initrd, kernel).
  Obviously, be prepared to restore it yourself.<ul>
<li>You can place a binary (such as an unsigned GRUB EFI binary) at <code>EFI/BOOT/BOOTX64.EFI</code> on a FAT32-formatted
USB Flash drive. Use the UEFI firmware interface to set this drive as the current boot drive, and ensure that a
security warning appears, which halts the boot process.</li>
<li>You also should verify that an image signed with the default UEFI secure boot keys does not boot &mdash; an Ubuntu CD
or bootable USB stick should allow you to verify this.</li>
</ul>
</li>
</ul>
<h3 id="in-case-of-an-error"><strong>In case of an error</strong><a class="headerlink" href="#in-case-of-an-error" title="Permanent link">&para;</a></h3>
<p>You can always find an up-to-date (and presumably working) version of the above description in the
script. <code>create_new_boot_in_fresh_vm</code> does exactly what is described above.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">GRUB walkthrough</label><label for="__tabbed_4_2">EfiStub walkthrough</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">qemu</span><span class="p">:</span> <span class="n">Qemu</span> <span class="o">=</span> <span class="n">Qemu</span><span class="p">(</span><span class="n">dry_run</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="n">qemu</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="n">qemu</span><span class="o">.</span><span class="n">disable_sudo_pass</span><span class="p">()</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="c1"># Avoid race condition between us and system-update runnin in the background</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sudo apt-get -y remove unattended-upgrades&#39;</span><span class="p">)</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="n">qemu</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">(),</span> <span class="n">script</span><span class="p">)</span> <span class="c1"># Copy the script in the VM</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="c1"># Generate SSL/UEFI</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sudo </span><span class="si">{</span><span class="n">GENERATE_UEFI_KEYS_EXAMPLE</span><span class="si">}</span><span class="s1"> &amp;&amp; sudo cp -r ./sec_out/*.cer /boot/efi&#39;</span><span class="p">)</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="c1"># Generate GPG</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="n">gpg_gen_out</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sudo </span><span class="si">{</span><span class="n">GENERATE_GPG_KEYS_EXAMPLE</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="n">gpg_keyid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">gpg_keyid_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">gpg_gen_out</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;g1&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="c1"># Generate GRUB PBKDF2 pass</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;grub-mkpasswd-pbkdf2 | tee ~/grub_pbkdf2_pass_out &amp;&amp; cat ~/grub_pbkdf2_pass_out | &#39;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a>                <span class="sa">f</span><span class="s1">&#39;grep &quot;PBKDF2 hash of your password is&quot; | sed </span><span class="se">\&#39;</span><span class="s1">s/PBKDF2 hash of your password is //g</span><span class="se">\&#39;</span><span class="s1"> &gt; &#39;</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a>                <span class="sa">f</span><span class="s1">&#39;~/grub_pbkdf2_pass&#39;</span><span class="p">,</span> <span class="n">resp</span><span class="o">=</span><span class="s2">&quot;Enter password:&quot;</span><span class="p">,</span> <span class="n">use_regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">resp</span><span class="o">=</span><span class="s2">&quot;Reenter password:&quot;</span><span class="p">,</span> <span class="n">use_regex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wait_for_echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">wait_for_echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># Repeat it</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="c1"># Create new /boot</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="n">make_new_boot_cmd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MAKE_NEW_BOOT_EXAMPLE_FS</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="n">make_new_boot_cmd</span> <span class="o">=</span> <span class="n">make_new_boot_cmd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--boot-dir ./boot&quot;</span><span class="p">,</span> <span class="s2">&quot;--boot-dir /boot&quot;</span><span class="p">)</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="n">make_new_boot_cmd</span> <span class="o">=</span> <span class="n">make_new_boot_cmd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--gpg/key-id ADDB2...&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;--gpg/key-id </span><span class="si">{</span><span class="n">gpg_keyid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sudo </span><span class="si">{</span><span class="n">make_new_boot_cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="n">qemu</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">qemu</span><span class="p">:</span> <span class="n">Qemu</span> <span class="o">=</span> <span class="n">Qemu</span><span class="p">(</span><span class="n">dry_run</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">qemu</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="n">qemu</span><span class="o">.</span><span class="n">disable_sudo_pass</span><span class="p">()</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sudo apt-get -y remove unattended-upgrades&#39;</span><span class="p">)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="n">qemu</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">(),</span> <span class="n">script</span><span class="p">)</span> <span class="c1"># Copy the script in the VM</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sudo </span><span class="si">{</span><span class="n">GENERATE_UEFI_KEYS_EXAMPLE</span><span class="si">}</span><span class="s1"> &amp;&amp; sudo cp -r ./sec_out/*.cer /boot/efi&#39;</span><span class="p">)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="n">make_new_boot_cmd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">MAKE_NEW_EFISTUB_BOOT_EXAMPLE_FS</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="n">make_new_boot_cmd</span> <span class="o">=</span> <span class="n">make_new_boot_cmd</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;--disk /dev/nvme0n1&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;--disk /dev/sda&quot;</span><span class="p">)</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="n">qemu</span><span class="o">.</span><span class="n">exec_and_wait</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sudo </span><span class="si">{</span><span class="n">make_new_boot_cmd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="n">qemu</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<hr />
<h2 id="optional-proper-testing-in-a-vm"><span class="critic comment">Optional</span> <strong>Proper testing in a VM</strong><a class="headerlink" href="#optional-proper-testing-in-a-vm" title="Permanent link">&para;</a></h2>
<p>So, how do you know that everything described above really works? How do you know I do not lie?
How do <em>I</em> know that I am right?</p>
<p>Well, there is only one way to check &mdash; test in a VM. In this section:</p>
<ul>
<li>we will install our favourite distro in VM (needs to be done manually)</li>
<li>set it up similarly to our main PC (needs to be done manually)</li>
<li>create new /boot with SecureBoot</li>
<li>and then we will be tampering/modifying random and sensitive parts of the OS in order to
  ensure that boot stops working.</li>
</ul>
<h3 id="setup-vm-semi-manually"><strong>Setup VM (semi-manually)</strong><a class="headerlink" href="#setup-vm-semi-manually" title="Permanent link">&para;</a></h3>
<p>Just follow instructions of <code>qemu/efistub/initialise</code> (or <code>qemu/grub/initialise</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>./secboot.py --no-run-tests  --log-level INFO qemu/initialise --vm-dir ~/devel/secboot_testing
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>You should install OS in VM:
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>  - Create disk: qemu-img create -f qcow2 secboot_testing/without-secboot.img 20G
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>  - Start installer: qemu-system-x86_64 -m 3G -drive file=secboot_testing/OVMF-without-secboot.fd,format=raw,if=pflash -boot d -enable-kvm -smp 2 -net nic -net user -cdrom ~/Downloads/kubuntu-20.10-desktop-amd64.iso -hda secboot_testing/without-secboot.img
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>  - Create user &quot;test&quot; with password &quot;test&quot;
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>Make the VM interactable from host console:
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>  - sudo nano /etc/default/grub
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>    # GRUB_TIMEOUT_STYLE=hidden
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>    GRUB_TIMEOUT=3
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>    GRUB_CMDLINE_LINUX_DEFAULT=&quot;console=tty0 console=ttyS0,38400n8&quot;
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>    GRUB_TERMINAL=serial
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>    GRUB_SERIAL_COMMAND=&quot;serial --speed=38400 --unit=0 --word=8 --parity=no --stop=1&quot;
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>  - Re-generate grub.cfg: grub-mkconfig -o /boot/grub/grub.cfg
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>Shutdown the OS
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>Press any key when ready...
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>2021-05-01 18:45:15,361 INFO recreate_new_snapshot:1389: Removed write permissions from secboot_testing/without-secboot.img and secboot_testing/OVMF-without-secboot.fd
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>2021-05-01 18:45:15,731 INFO recreate_new_snapshot:1403: Created new snapshot QemuImage(image=PosixPath(&#39;secboot_testing/with-secboot.img&#39;), uefi=PosixPath(&#39;secboot_testing/OVMF-with-secboot.fd&#39;)) from QemuImage(image=PosixPath(&#39;secboot_testing/without-secboot.img&#39;), uefi=PosixPath(&#39;secboot_testing/OVMF-without-secboot.fd&#39;)) and made the latter immutable
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>test@test-Standard-PC-i440FX-PIIX-1996:~$
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>test@test-Standard-PC-i440FX-PIIX-1996:~$ echo &quot;test ALL=(ALL) NOPASSWD: ALL&quot; | sudo tee -a /etc/sudoers
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>[sudo] password for test:
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>test ALL=(ALL) NOPASSWD: ALL
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>test@test-Standard-PC-i440FX-PIIX-1996:~$ sudo apt-get -y remove unattended-upgrades
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>...
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>Now you have to enroll new keys in UEFI:
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>  - press and hold &lt;Esc&gt; to enter UEFI settings
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>  - Device Manager
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>  - Secure Boot configuration
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>  - Secure Boot Mode -&gt; Custom Mode
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>  - Custom Secure Boot Options
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>  - DB Options -&gt; Enroll Signature -&gt; Enter -&gt; db.cer -&gt; Commit changes and exit
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>  - Repeat for KEK
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a>  - Repeat for PK
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a>  - Esc -&gt; Esc -&gt; Esc -&gt; On the main menu: Reset
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a>Press any key when you are ready...
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>...
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a>2021-05-01 18:48:51,060 INFO qemu_initialise:1660: SecureBoot has been successfully enabled. Everything works fine. Shuttig down...
</code></pre></div>
<h3 id="run-automated-test"><strong>Run automated test</strong><a class="headerlink" href="#run-automated-test" title="Permanent link">&para;</a></h3>
<p>Use option <code>qemu/efistub/run-tests</code> (or <code>qemu/grub/run-tests</code>). The script will create a temporary snapshot, modify
various parts of the system (by writing random byte in the middle of a file, so that signature be invalid), reboot
the system, and verify that it does not load (and verify that it did not load due to signature verification check,
not due to the garbage we wrote &mdash; this is achieved by switching of UEFI in VM, and ensuring that it loads fine).</p>
<p>Example of one such modification:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">qemu</span><span class="p">:</span> <span class="n">Qemu</span> <span class="o">=</span> <span class="n">Qemu</span><span class="p">(</span><span class="n">dry_run</span><span class="p">,</span> <span class="n">disposable</span><span class="p">)</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="k">assert</span> <span class="n">qemu</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">==</span> <span class="n">BootStatuses</span><span class="o">.</span><span class="n">Ok</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="n">qemu</span><span class="o">.</span><span class="n">overwrite_middle_of</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/boot/efi/EFI/BOOT/BOOTX64.EFI&quot;</span><span class="p">))</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="n">qemu</span><span class="o">.</span><span class="n">overwrite_middle_of</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/boot/efi/EFI/ubuntu/shimx64.efi&quot;</span><span class="p">))</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="n">qemu</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="k">assert</span> <span class="n">qemu</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">==</span> <span class="n">BootStatuses</span><span class="o">.</span><span class="n">UefiFailedToLoadShim</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="c1"># Check that OS failed to boot not because we broke its binaries by writing garbage into them, but</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="c1"># because of signature verification. We do it, by trying to boot the same OS with initial UEFI (without keys):</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="n">qemu</span><span class="p">:</span> <span class="n">Qemu</span> <span class="o">=</span> <span class="n">Qemu</span><span class="p">(</span><span class="n">dry_run</span><span class="p">,</span> <span class="n">QemuImage</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">disposable</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">uefi</span><span class="o">=</span><span class="n">orig_uefi</span><span class="p">))</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="k">assert</span> <span class="n">qemu</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="o">==</span> <span class="n">BootStatuses</span><span class="o">.</span><span class="n">Ok</span>
</code></pre></div></td></tr></table></div>
<h3 id="useful-qemu-commands"><strong>Useful QEMU commands</strong><a class="headerlink" href="#useful-qemu-commands" title="Permanent link">&para;</a></h3>
<ul>
<li>QEMU images:<ul>
<li>Create an image with max size 20G: <code>qemu-img create -f qcow2 secboot-initial.img 20G</code></li>
<li>In case you need later to resize it: <code>qemu-img resize secboot-initial.img +10G</code></li>
</ul>
</li>
<li>Bring UEFI: <code>sudo apt install ovmf &amp;&amp; cp /usr/share/ovmf/OVMF.fd ./OVMF.fd</code></li>
<li>Install it: <code>qemu-system-x86_64 -m 4G -drive file=./OVMF.fd,format=raw,if=pflash -boot d -enable-kvm -smp 4 -net nic -net user -cdrom ~/Downloads/kubuntu-20.10-desktop-amd64.iso -hda secboot-initial.img</code></li>
<li>Create a snapshot: <code>qemu-img create -f qcow2 -b sb-image.img trying_to_flip_a_bit.img</code></li>
<li>Mount a folder from host<ul>
<li><code>-virtfs local,path=~/devel/,mount_tag=host0,security_model=passthrough,id=host0</code></li>
<li>Add entry in guest <code>/etc/fstab</code>: <code>TODO</code></li>
</ul>
</li>
<li>Better screen resolution: <code>-vga virtio</code></li>
<li>
<p>Modify binary file (to check that the modification will be caught):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>(export f=file-to-change.txt; cp $f $f.bak; printf &quot;\x56&quot; | dd of=$f bs=1 seek=10 count=1 conv=notrunc; echo; cmp -b -c $f $f.bak; md5sum $f $f.bak)
</code></pre></div>
</li>
</ul>
<hr />
<h2 id="resources"><strong>Resources</strong><a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<ul>
<li>General Info:<ul>
<li>NSA:<ul>
<li><a href="https://media.defense.gov/2020/Sep/15/2002497594/-1/-1/0/CTR-UEFI-Secure-Boot-Customization-UOO168873-20.PDF">NSA Pdf</a></li>
<li><a href="https://github.com/nsacyber/Hardware-and-Firmware-Security-Guidance">Hardware-and-Firmware-Security-Guidance Repo</a></li>
<li><a href="https://www.nsa.gov/Portals/70/documents/what-we-do/cybersecurity/professional-resources/ctr-uefi-defensive-practices-guidance.pdf?ver=2018-11-06-074836-090">UEFI DEFENSIVE PRACTICES GUIDANCE</a></li>
</ul>
</li>
<li>Rod Smith <a href="https://www.rodsbooks.com/efi-bootloaders/secureboot.html">Managing EFI Boot Loaders for Linux: Dealing with Secure Boot</a></li>
<li><a href="https://www.linuxjournal.com/content/take-control-your-pc-uefi-secure-boot">Take Control of Your PC with UEFI Secure Boot</a></li>
</ul>
</li>
<li><a href="https://queue.acm.org/detail.cfm?id=3382016">Securing the Boot Process</a><ul>
<li><a href="https://wiki.ubuntu.com/UEFI/SecureBoot">SecureBoot</a></li>
</ul>
</li>
<li>Guides:<ul>
<li>Very good guide: <a href="https://fit-pc.com/wiki/index.php?title=Linux_Mint_19:_Secure_Boot&amp;mobileaction=toggle_view_mobile">Linux Mint 19: Secure Boot</a></li>
<li><a href="https://ruderich.org/simon/notes/secure-boot-with-grub-and-signed-linux-and-initrd">Secure Boot with GRUB 2 and signed Linux images and initrds</a></li>
<li><a href="https://github.com/xmikos/cryptboot/blob/master/cryptboot-efikeys">A repo with a script</a> where most of the things is implemented</li>
</ul>
</li>
<li>
<p>Yubikey PIV:</p>
<ul>
<li><a href="https://casualhacking.io/blog/2020/5/24/harden-your-linux-uefi-secure-boot-using-grub-signature-checking-and-a-yubikey">Harden your Linux UEFI Secure Boot using GRUB signature checking and a Yubikey</a></li>
</ul>
</li>
<li>
<p>Kernel modules signing:</p>
<ul>
<li><a href="https://www.kernel.org/doc/html/v4.14/admin-guide/module-signing.html">Kernel module signing facility</a></li>
<li><a href="https://superuser.com/questions/1438279/how-to-sign-a-kernel-module-ubuntu-18-04">How to sign a kernel module Ubuntu 18.04</a></li>
<li><a href="https://unix.stackexchange.com/questions/493170/how-to-verify-a-kernel-module-signature">How to verify a kernel module signature?</a></li>
<li><a href="https://unix.stackexchange.com/questions/438954/signing-a-compressed-kernel-module-for-use-with-secure-boot">Signing a compressed kernel module for use with Secure Boot</a></li>
<li><a href="https://unix.stackexchange.com/questions/74022/sign-a-module-after-kernel-compilation">Sign a module after kernel compilation</a></li>
</ul>
</li>
<li>Other<ul>
<li><a href="https://cisofy.com/lynis/">Lynis, an introduction</a></li>
<li><a href="https://safeboot.dev/">safeboot: Booting Linux Safely</a></li>
<li><a href="https://uefi.org/sites/default/files/resources/UEFI%20Firmware%20-%20Security%20Concerns%20and%20Best%20Practices.pdf">PDF Presentation</a> explaining risks and mitigations and phases.</li>
<li><a href="https://patents.google.com/patent/US8484474B2/en">Methods for firmware signature</a></li>
</ul>
</li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.expand", "navigation.top", "content.tabs.link", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.c7c1ca2c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.203fd0bc.min.js"></script>
      
        <script src="../../assets/javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>