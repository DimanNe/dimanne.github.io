
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../C%2B%2B/">
      
      
        <link rel="next" href="../English/Grammar/01.Infinitive/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44+insiders-4.53.14">
    
    
      
        <title>Rust - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.12320a83.min.css">
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343za8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746m1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275M6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.75.75 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.75.75 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L6.94 8 4.97 6.03a.75.75 0 0 1 .018-1.042.75.75 0 0 1 1.042-.018"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.5 3.5 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327q0 .15-.025.292c.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5q-.002.615-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A5 5 0 0 1 8 16a5 5 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5 5 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.7 1.7 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06m.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.17.17 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rust" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rust
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  MkDocs

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../C%2B%2B/" class="md-tabs__link">
        
  
    
  
  C++

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Rust

      </a>
    </li>
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../English/Grammar/01.Infinitive/" class="md-tabs__link">
          
  
  English

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Linux/alternatives/" class="md-tabs__link">
          
  
  Linux

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    MkDocs
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../C%2B%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    C++
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    Rust
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    Rust
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#c-differences" class="md-nav__link">
    <span class="md-ellipsis">
      
        C++ differences
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-profiling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance &amp; Profiling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cargo-project-structure-building-testing-benchmarking-other-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cargo: Project structure, building, testing, benchmarking &amp; other tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cargo: Project structure, building, testing, benchmarking & other tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-directories-packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create directories / packages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditional-compilation-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conditional compilation &amp; Features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Show structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#librs-mainrs-mod-pub-use-and-other" class="md-nav__link">
    <span class="md-ellipsis">
      
        lib.rs, main.rs: mod, pub, use and other
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benchmarking-cargo-bench-criterion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benchmarking: cargo bench &amp; criterion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fuzzing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enums" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enums
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern matching
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Traits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Traits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marker-traits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Marker traits
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-smart-pointers" class="md-nav__link">
    <span class="md-ellipsis">
      
        References &amp; (smart) pointers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logical-const-ness-aka-mutable" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logical const-ness aka mutable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clone-vs-clone-vs-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        ::clone vs .clone vs operator=
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multithreading
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-typedefs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using &amp; Typedefs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arrays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arrays
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conversions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conversions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#almost-no-implicit-conversions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Almost no implicit conversions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#but-it-might-appear-that-it-has-implicit-conversions" class="md-nav__link">
    <span class="md-ellipsis">
      
        But it might appear that it has implicit conversions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#types-of-casts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Types of casts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fat-pointers-trait-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fat pointers &amp; trait objects
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deref-vs-asreft" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deref vs AsRef&lt;T>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#borrow-vs-asreft-toowned-cow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Borrow vs AsRef&lt;T> &amp; ToOwned &amp; Cow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-referential-data-structures-pin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Self-Referential Data Structures &amp; Pin
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iterators" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterators
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Iterators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iterator-trait" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator Trait
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterator-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator transformations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ffi-foreign-function-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        FFI: foreign function interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Macros
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declarative-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Declarative Macros
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procedural-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Procedural Macros
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unsafe-rust" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unsafe Rust
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Unsafe Rust">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exotically-sized-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exotically Sized Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct-layout-types-reprc-reprtransparent-repru-repri-reprpacked-repralignn" class="md-nav__link">
    <span class="md-ellipsis">
      
        Struct layout types: repr(C), repr(transparent), repr(u), repr(i), repr(packed), repr(align(n))
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifetimes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifetimes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifetime-elision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifetime Elision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-check" class="md-nav__link">
    <span class="md-ellipsis">
      
        Drop Check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phantomdata" class="md-nav__link">
    <span class="md-ellipsis">
      
        PhantomData
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting-borrows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Splitting Borrows
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-dot-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Dot Operator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transmutes-aka-reinterpret_cast" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transmutes (aka reinterpret_cast)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-uninitialized-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working With Uninitialized Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leaking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exceptions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#std-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        std types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="std types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#other_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-crates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Useful crates
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    English
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    English
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Grammar
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Grammar
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Grammar/01.Infinitive/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Infinitive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Grammar/02.-ing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    -ing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Grammar/03.ModalVerbs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Modal Verbs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Grammar/04.SomethingFollowedBySomething/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    something followed by something rules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Grammar/05.Articles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Articles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Grammar/06.Other/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Other
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Grammar/07.UnitsFromMurphy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Some units from Murphy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Vocabulary
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Vocabulary
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/10.RareWords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Rare Words
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/20.WordUsage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Word Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/30.PhrasesIdiomsCollacations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Phrases, Idioms & Collacations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/40.CommonWordsUncommonMeaning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Common words with uncommon meaning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/41.ReplacementForVery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Replacement for "very"
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/42.UAndNonU/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    U and Non-U
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/43.CollectiveNouns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Collective Nouns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/44.ReportingVerbs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Reporting Verbs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/45.WaysOfMoving/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Ways of Moving
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/46.RelatedWords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Related Words
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/50.LinkingWords/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Linking Words
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/55.Conjunctions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Conjunction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/90.Prefixes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Prefixes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../English/Vocabulary/91.Suffixes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Suffixes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/alternatives/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Alternatives
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apt_repos/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    apt repos
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/certificates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Certificates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/disks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Disks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/network/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Network
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/secure_boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Secure boot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Software
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/tools_and_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tools & Utils
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/usb_udev/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    usb & udev
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/video_editing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Video editing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Apps
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Apps
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/bash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    bash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/cmake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    cmake
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/fail2ban/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Fail2Ban
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/git/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    git
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/lldb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    lldb
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/openssl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    OpenSSL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/qt_qtcreator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Qt & QtCreator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/ripgrep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    ripgrep
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/screen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    screen
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/sql/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/ssh/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    ssh
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/strace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    strace
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/apps/systemd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    systemd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Performance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/performance/010.performance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/performance/020.concurrency/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Concurrency
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/performance/030.memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    memory usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/performance/040.asm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    asm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/performance/050.Gregg/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Brendan Gregg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/performance/110.tools-orbit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tools: orbit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Linux/performance/120.tools-perf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Tools: perf
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#c-differences" class="md-nav__link">
    <span class="md-ellipsis">
      
        C++ differences
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-profiling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Performance &amp; Profiling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cargo-project-structure-building-testing-benchmarking-other-tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cargo: Project structure, building, testing, benchmarking &amp; other tools
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cargo: Project structure, building, testing, benchmarking & other tools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-directories-packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Create directories / packages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditional-compilation-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conditional compilation &amp; Features
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#show-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Show structure
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#librs-mainrs-mod-pub-use-and-other" class="md-nav__link">
    <span class="md-ellipsis">
      
        lib.rs, main.rs: mod, pub, use and other
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benchmarking-cargo-bench-criterion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benchmarking: cargo bench &amp; criterion
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Documentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fuzzing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fuzzing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enums" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enums
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-matching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern matching
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Traits
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Traits">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#marker-traits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Marker traits
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references-smart-pointers" class="md-nav__link">
    <span class="md-ellipsis">
      
        References &amp; (smart) pointers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Other">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logical-const-ness-aka-mutable" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logical const-ness aka mutable
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clone-vs-clone-vs-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        ::clone vs .clone vs operator=
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      
        Multithreading
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-typedefs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using &amp; Typedefs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arrays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arrays
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conversions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conversions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conversions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#almost-no-implicit-conversions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Almost no implicit conversions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#but-it-might-appear-that-it-has-implicit-conversions" class="md-nav__link">
    <span class="md-ellipsis">
      
        But it might appear that it has implicit conversions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#types-of-casts" class="md-nav__link">
    <span class="md-ellipsis">
      
        Types of casts
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fat-pointers-trait-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fat pointers &amp; trait objects
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deref-vs-asreft" class="md-nav__link">
    <span class="md-ellipsis">
      
        Deref vs AsRef&lt;T>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#borrow-vs-asreft-toowned-cow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Borrow vs AsRef&lt;T> &amp; ToOwned &amp; Cow
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#self-referential-data-structures-pin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Self-Referential Data Structures &amp; Pin
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iterators" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterators
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Iterators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iterator-trait" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator Trait
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterator-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Iterator transformations
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ffi-foreign-function-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        FFI: foreign function interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Macros
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#declarative-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Declarative Macros
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#procedural-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Procedural Macros
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unsafe-rust" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unsafe Rust
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Unsafe Rust">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exotically-sized-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exotically Sized Types
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct-layout-types-reprc-reprtransparent-repru-repri-reprpacked-repralignn" class="md-nav__link">
    <span class="md-ellipsis">
      
        Struct layout types: repr(C), repr(transparent), repr(u), repr(i), repr(packed), repr(align(n))
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifetimes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifetimes
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lifetime-elision" class="md-nav__link">
    <span class="md-ellipsis">
      
        Lifetime Elision
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#drop-check" class="md-nav__link">
    <span class="md-ellipsis">
      
        Drop Check
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phantomdata" class="md-nav__link">
    <span class="md-ellipsis">
      
        PhantomData
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting-borrows" class="md-nav__link">
    <span class="md-ellipsis">
      
        Splitting Borrows
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-dot-operator" class="md-nav__link">
    <span class="md-ellipsis">
      
        The Dot Operator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transmutes-aka-reinterpret_cast" class="md-nav__link">
    <span class="md-ellipsis">
      
        Transmutes (aka reinterpret_cast)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-uninitialized-memory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Working With Uninitialized Memory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leaking" class="md-nav__link">
    <span class="md-ellipsis">
      
        Leaking
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exceptions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#std-types" class="md-nav__link">
    <span class="md-ellipsis">
      
        std types
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="std types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#other_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Other
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#useful-crates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Useful crates
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="rust"><strong>Rust</strong><a class="headerlink" href="#rust" title="Permanent link">&para;</a></h1>
<p>Sources &amp; Books:</p>
<ul>
<li>
<p><a href="https://rust-book.cs.brown.edu/experiment-intro.html"><strong>The Rust Programming Language book</strong></a></p>
</li>
<li>
<p><a href="https://rust-lang.github.io/async-book/"><strong>Asynchronous Programming in Rust</strong></a></p>
</li>
<li>
<p><a href="https://lurklurk.org/effective-rust/cover.html"><strong>Effective rust</strong></a></p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/nomicon/"><strong>The Rustonomicon</strong></a></p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/index.html"><strong>std crate</strong></a></p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/unstable-book/the-unstable-book.html"><strong>The Unstable Book</strong></a></p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/reference/introduction.html"><strong>The Rust Reference</strong></a></p>
</li>
<li>
<p><a href="https://rust-lang.github.io/api-guidelines/about.html"><strong>Rust API Guidelines</strong></a></p>
</li>
<li>
<p><a href="https://rust-lang-nursery.github.io/rust-cookbook/"><strong>Rust cookbook</strong></a></p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/rust-by-example/index.html"><strong>Rust by Example</strong></a></p>
</li>
<li>
<p><a href="https://veykril.github.io/tlborm/"><strong>The Little Book of Rust Macros</strong></a></p>
</li>
<li>
<p><a href="https://rust-fuzz.github.io/book/"><strong>Fuzz Book</strong></a></p>
</li>
</ul>
<hr />
<h2 id="c-differences"><strong>C++ differences</strong><a class="headerlink" href="#c-differences" title="Permanent link">&para;</a></h2>
<ul>
<li>Blocks are expressions.</li>
<li>Move or copy by default.<ul>
<li>Move is a real move: it is not allowed to use a moved-from variable.</li>
</ul>
</li>
<li>Const by default.</li>
<li>Mutable references vs const references have the same relationship as read-write lock: only a single mutable
  reference is allowed, or multiple const references.</li>
<li><code>self</code> is explicit, like in Python, but unlike Python, it is useful &mdash; we specify type modifiers, such as
  <code>const</code>/<code>mut</code>, <code>ref</code> or move.</li>
<li>Enums can have associated with its fields data/types (so it is a mix of <code>enum class</code> and <code>std::variant</code>).</li>
</ul>
<hr />
<h2 id="performance-profiling"><strong>Performance &amp; Profiling</strong><a class="headerlink" href="#performance-profiling" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Get Rust fork of perl flamegraph</strong>: <code>cargo install inferno</code></p>
</li>
<li>
<p><strong>Add debug info into release build</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">[profile.release]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="na">debug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</code></pre></div>
</li>
<li>
<p><strong>Record perf data</strong>: <code>perf record -F 1987 --call-graph dwarf your-app-here</code></p>
</li>
<li>
<p><strong>Create flame and icicle SVGs</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">set</span> bn <span class="s2">&quot;v2-F1987.1&quot;</span><span class="p">;</span> <span class="k">set</span> mw 0.01<span class="p">;</span> <span class="k">set</span> suffix <span class="s2">&quot;</span><span class="nv">$mw</span><span class="s2">&quot;</span><span class="p">;</span> perf script <span class="o">|</span> inferno-collapse-perf <span class="o">&gt;</span> <span class="nv">$bn</span>.perf.data.folded<span class="p">;</span> <span class="se">\</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>cat <span class="nv">$bn</span>.perf.data.folded <span class="o">|</span> inferno-flamegraph --minwidth <span class="nv">$mw</span> --width <span class="m">2250</span> --title <span class="s2">&quot;</span><span class="nv">$bn</span><span class="s2"> </span><span class="nv">$suffix</span><span class="s2">&quot;</span> --reverse --inverted <span class="o">&gt;</span> ./<span class="nv">$bn</span>-<span class="nv">$suffix</span>.perf-icicle.svg <span class="o">&amp;&amp;</span> <span class="se">\</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>cat <span class="nv">$bn</span>.perf.data.folded <span class="o">|</span> inferno-flamegraph --minwidth <span class="nv">$mw</span> --width <span class="m">2250</span> --title <span class="s2">&quot;</span><span class="nv">$bn</span><span class="s2"> </span><span class="nv">$suffix</span><span class="s2">&quot;</span> <span class="o">&gt;</span> ./<span class="nv">$bn</span>-<span class="nv">$suffix</span>.perf-flame.svg
</code></pre></div>
</li>
<li>
<p><strong>Diff</strong>: <code>inferno-diff-folded folded1 folded2 | inferno-flamegraph &gt; diff2.svg</code></p>
</li>
</ul>
<hr />
<h2 id="cargo-project-structure-building-testing-benchmarking-other-tools"><strong>Cargo: Project structure, building, testing, benchmarking &amp; other tools</strong><a class="headerlink" href="#cargo-project-structure-building-testing-benchmarking-other-tools" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Get unused dependencies</strong>: <code>cargo-udeps</code></li>
<li><strong>Check for security issues, licensing conflicts</strong>: <code>cargo-deny</code></li>
<li><strong>Run</strong>: <code>cargo run --bin digester -- --read-from-file $HOME/file1.txt --log-level trace</code></li>
<li><strong>Build</strong>: <code>cargo build</code>, build tests too: <code>cargo test --no-run</code></li>
<li><strong>Tests</strong>:<ul>
<li>Code coverage: <a href="https://lib.rs/crates/cargo-tarpaulin"><code>cargo-tarpaulin</code></a></li>
<li>Build &amp; run test:<ul>
<li><strong>Run specific test with stdout</strong>: <code>cargo test --release -- --nocapture decoded_reader_zstd_encoder_zstd_decoder_decoded_writer</code></li>
<li><strong>Parallel</strong>: <code>cargo test -- --test-threads=2</code></li>
<li><strong>Run ignored</strong>: <code>cargo test -- --ignored</code></li>
<li><strong>Run only non-integration tests</strong>: <code>cargo test --lib -- --nocapture</code></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/rust-lang/miri">Miri</a></li>
<li>Deadlock detection tools: <a href="https://docs.rs/no_deadlocks/latest/no_deadlocks/">no_deadlocks</a>, ThreadSanitizer,
  <a href="https://amanieu.github.io/parking_lot/parking_lot/deadlock/index.html">parking_lot::deadlock</a></li>
<li>Clippy</li>
</ul>
<h4 id="create-directories-packages"><strong>Create directories / packages</strong><a class="headerlink" href="#create-directories-packages" title="Permanent link">&para;</a></h4>
<p><a href="https://doc.rust-lang.org/cargo/index.html">Cargo documentation</a>.</p>
<p>From smaller units to larger:</p>
<ol>
<li>
<p><strong>Module</strong>: corresponds to a single <code>.rs</code> or namespace (it is not required to create a file. A
   module can be created &ldquo;in-place&rdquo;).</p>
</li>
<li>
<p><strong>Crate</strong>: an executable or the (main and the only!) library of a package.</p>
</li>
<li>
<p><strong>Package</strong>: can contain multiple binary crates and <em>at most</em> one library-crate
   (<a href="https://doc.rust-lang.org/cargo/reference/cargo-targets.html">1</a>,
   <a href="https://internals.rust-lang.org/t/how-about-changing-lib-to-lib-to-allow-multiple-library-in-a-crate/2022">2</a>),
   this corresponds to C++ library and is the main unit of sharing:</p>
<blockquote>
<p>The filename defaults to <code>src/lib.rs</code>, and the name of the library defaults to the name of the package.
   A package can have only one library</p>
</blockquote>
<p>So, from the point of view of dependencies, package == library.</p>
<p>Each package is handled by its <code>Cargo.toml</code> and can be published to crates.io.</p>
</li>
<li>
<p><strong>Workspace</strong>: analogous to a project and consists of multiple (presumably related) packages/libraries.
   <a href="https://rust-book.cs.brown.edu/ch14-03-cargo-workspaces.html">How-to.</a></p>
</li>
</ol>
<p>From the practical point of view, create several libraries (==directories), like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>cargo<span class="w"> </span>new<span class="w"> </span>input<span class="w">  </span><span class="c1"># will create &quot;input&quot; package (and its directory, along with toml file, src, etc...)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>cargo<span class="w"> </span>new<span class="w"> </span>output<span class="w"> </span><span class="c1"># same</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>cargo<span class="w"> </span>new<span class="w"> </span>query<span class="w">  </span><span class="c1"># same</span>
</code></pre></div>
<p>Then you can put them in a single workspace via this:</p>
<div class="highlight"><span class="filename">Cargo.toml</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">[workspace]</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">members</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">   </span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">   </span><span class="s2">&quot;output&quot;</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">   </span><span class="s2">&quot;query&quot;</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">]</span>
</code></pre></div>
<h4 id="conditional-compilation-features"><strong>Conditional compilation &amp; Features</strong><a class="headerlink" href="#conditional-compilation-features" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">// Build with `RUSTFLAGS` set to:</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1">//   &#39;--cfg myname=&quot;a&quot; --cfg myname=&quot;b&quot;&#39;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="cp">#[cfg(myname = </span><span class="s">&quot;a&quot;</span><span class="cp">)]</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;cfg(myname = &#39;a&#39;) is set&quot;</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="cp">#[cfg(myname = </span><span class="s">&quot;b&quot;</span><span class="cp">)]</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;cfg(myname = &#39;b&#39;) is set&quot;</span><span class="p">);</span>
</code></pre></div>
<p>For example, the following chunk of a manifest file includes six features:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">[features]</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[&quot;featureA&quot;]</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="na">featureA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="na">featureB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># Enabling `featureAB` also enables `featureA` and `featureB`.</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="na">featureAB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[&quot;featureA&quot;, &quot;featureB&quot;]</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="na">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="k">[dependencies]</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="na">rand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">{ version = &quot;^0.8&quot;, optional = true }</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="na">hex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;^0.4&quot;</span>
</code></pre></div>
<p>The <code>rand</code> crate is a dependency that is marked as <code>optional = true</code>, and that effectively makes <code>"rand"</code>
into the name of a feature. If the crate is compiled with <code>--features rand</code>, then that dependency is activated:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="cp">#[cfg(feature = </span><span class="s">&quot;rand&quot;</span><span class="cp">)]</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">pick_a_number</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="n">rand</span><span class="p">::</span><span class="n">random</span><span class="p">::</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">()</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="p">}</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="cp">#[cfg(not(feature = </span><span class="s">&quot;rand&quot;</span><span class="cp">))]</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">pick_a_number</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="c1">// chosen by fair dice roll.</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">}</span>
</code></pre></div>
<p>So you can determine a crate&rsquo;s features by examining <code>[features]</code> as well as optional <code>[dependencies]</code> in the
crate&rsquo;s <code>Cargo.toml</code> file.</p>
<p>Feature unification means that features should be additive; it&rsquo;s a bad idea to have mutually incompatible
features because there&rsquo;s nothing to prevent the incompatible features being simultaneously enabled by
different users.</p>
<h4 id="show-structure"><strong>Show structure</strong><a class="headerlink" href="#show-structure" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>cargo tree
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>input v0.1.0 (/home/dimanne/devel/scripts/observability/input)
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>├── anyhow v1.0.75
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>├── protobuf v3.2.0
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>│   ├── bytes v1.5.0
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>│   ├── once_cell v1.18.0
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>│   ├── protobuf-support v3.2.0
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>│   │   └── thiserror v1.0.48
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>│   │       └── thiserror-impl v1.0.48 (proc-macro)
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>│   │           ├── proc-macro2 v1.0.67
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>│   │           │   └── unicode-ident v1.0.12
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>│   │           ├── quote v1.0.33
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>│   │           │   └── proc-macro2 v1.0.67 (*)
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>│   │           └── syn v2.0.37
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>│   │               ├── proc-macro2 v1.0.67 (*)
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>│   │               ├── quote v1.0.33 (*)
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>│   │               └── unicode-ident v1.0.12
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>│   └── thiserror v1.0.48 (*)
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>└── protobuf-json-mapping v3.2.0
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>    ├── protobuf v3.2.0 (*)
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>    ├── protobuf-support v3.2.0 (*)
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>    └── thiserror v1.0.48 (*)
</code></pre></div>
<h4 id="librs-mainrs-mod-pub-use-and-other"><strong>lib.rs, main.rs: mod, pub, use and other</strong><a class="headerlink" href="#librs-mainrs-mod-pub-use-and-other" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Start from the crate root</strong>: When compiling a crate, the compiler first looks in the crate root file
  (usually <code>src/lib.rs</code> for a library crate or <code>src/main.rs</code> for a binary crate) for code to compile.</li>
<li><strong>Declaring modules</strong>: In the crate root file, you can declare new modules; say, you declare a “garden”
  module with <code>mod garden;</code>. The compiler will look for the module’s code in these places:<ul>
<li>Inline, within curly brackets that replace the semicolon following <code>mod garden</code></li>
<li>In the file <code>src/garden.rs</code></li>
<li>In the file <code>src/garden/mod.rs</code></li>
</ul>
</li>
<li><strong>Declaring <em>sub</em>modules</strong>: In any file other than the crate root, you can declare submodules. For example,
  you might declare <code>mod vegetables;</code> in <code>src/garden.rs</code>. The compiler will look for the submodule’s code
  within the directory named for the parent module in these places:<ul>
<li>Inline, directly following <code>mod vegetables</code>, within curly brackets instead of the semicolon</li>
<li>In the file <code>src/garden/vegetables.rs</code></li>
<li>In the file <code>src/garden/vegetables/mod.rs</code></li>
</ul>
</li>
<li><strong>Paths to code in modules</strong>: Once a module is part of your crate, you can refer to code in that module from
  anywhere else in that same crate (as long as the privacy rules allow), using the path to the code. For
  example, an <code>Asparagus</code> type in the garden vegetables module would be found at
  <code>crate::garden::vegetables::Asparagus</code>.</li>
<li><strong>Private vs public</strong>: Code within a module is private from its parent modules by default. To make a module
  public, declare it with <code>pub mod</code> instead of <code>mod</code>. To make items within a public module public as well,
  use <code>pub</code> before their declarations.</li>
<li>
<p><strong>The <code>use</code> keyword</strong>: Within a scope, the <code>use</code> keyword creates shortcuts to items to reduce repetition of
  long paths. In any scope that can refer to <code>crate::garden::vegetables::Asparagus</code>, you can create a shortcut
  with <code>use crate::garden::vegetables::Asparagus;</code> and from then on you only need to write <code>Asparagus</code> to make
  use of that type in the scope.</p>
<p>aliases are supported with <code>use</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">fmt</span><span class="p">::</span><span class="nb">Result</span><span class="p">;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="nb">Result</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">IoResult</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p><strong>Re-exporting different structure</strong>: Re-exporting is useful when the internal structure of your code is
  different from how programmers calling your code would think about the domain. With pub use, we can write
  our code with one structure but expose a different structure. Doing so makes our library well organized for
  programmers working on the library and programmers calling the library:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">mod</span><span class="w"> </span><span class="nn">front_of_house</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">mod</span><span class="w"> </span><span class="nn">hosting</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">add_to_waitlist</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">}</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="k">pub</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">crate</span><span class="p">::</span><span class="n">front_of_house</span><span class="p">::</span><span class="n">hosting</span><span class="p">;</span>
</code></pre></div>
</li>
</ul>
<h4 id="benchmarking-cargo-bench-criterion"><strong>Benchmarking: cargo bench &amp; criterion</strong><a class="headerlink" href="#benchmarking-cargo-bench-criterion" title="Permanent link">&para;</a></h4>
<p>See <a href="https://crates.io/crates/criterion">criterion crate</a>.</p>
<p>The <a href="https://doc.rust-lang.org/cargo/commands/cargo-bench.html">cargo bench</a> command runs special test cases
that repeatedly perform an operation, and emits average timing information for the operation.</p>
<p>Example of benchmarking <code>factorial</code> function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="cp">#![feature(test)]</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">test</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="cp">#[bench]</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="k">fn</span><span class="w"> </span><span class="nf">bench_factorial</span><span class="p">(</span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">test</span><span class="p">::</span><span class="n">Bencher</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">iter</span><span class="p">(</span><span class="o">||</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factorial</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">hint</span><span class="p">::</span><span class="n">black_box</span><span class="p">(</span><span class="mi">15</span><span class="p">));</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">1_307_674_368_000</span><span class="p">);</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="p">}</span>
</code></pre></div>
<h4 id="documentation"><strong>Documentation</strong><a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h4>
<p><code>cargo doc</code> build documentation.</p>
<h4 id="fuzzing"><strong>Fuzzing</strong><a class="headerlink" href="#fuzzing" title="Permanent link">&para;</a></h4>
<p><a href="https://github.com/rust-fuzz/cargo-fuzz">cargo fuzz</a></p>
<p>See <a href="https://rust-fuzz.github.io/book/">Fuzz Book</a></p>
<hr />
<h2 id="enums"><strong>Enums</strong><a class="headerlink" href="#enums" title="Permanent link">&para;</a></h2>
<p>Enum &ldquo;values&rdquo; as functions:</p>
<p>name of each enum variant that we define also becomes an initializer function. We can use these initializer
functions as function pointers that implement the closure traits, which means we can specify the initializer
functions as arguments for methods that take closures, like so:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Status</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="n">Value</span><span class="p">(</span><span class="kt">u32</span><span class="p">),</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="n">Stop</span><span class="p">,</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="p">}</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="kd">let</span><span class="w"> </span><span class="n">list_of_statuses</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Status</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="k">u32</span><span class="o">..</span><span class="mi">20</span><span class="p">).</span><span class="n">map</span><span class="p">(</span><span class="n">Status</span><span class="p">::</span><span class="n">Value</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span>
</code></pre></div>
<hr />
<h2 id="pattern-matching"><strong>Pattern matching</strong><a class="headerlink" href="#pattern-matching" title="Permanent link">&para;</a></h2>
<p><strong>if let</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Using purple as the background color&quot;</span><span class="p">);</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Using orange as the background color&quot;</span><span class="p">);</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p><strong>while let</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">stack</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="k">while</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">top</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">top</span><span class="p">);</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="p">}</span>
</code></pre></div>
<p><strong>Function parameters</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">print_coordinates</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">):</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Current location: ({}, {})&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="p">}</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">    </span><span class="n">print_coordinates</span><span class="p">(</span><span class="o">&amp;</span><span class="n">point</span><span class="p">);</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="p">}</span>
</code></pre></div>
<p><strong>or</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;one or two&quot;</span><span class="p">),</span>
</code></pre></div>
<p><strong>Ranges</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="sc">&#39;a&#39;</span><span class="o">..=</span><span class="sc">&#39;j&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;early ASCII letter&quot;</span><span class="p">),</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="sc">&#39;k&#39;</span><span class="o">..=</span><span class="sc">&#39;z&#39;</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;late ASCII letter&quot;</span><span class="p">),</span>
</code></pre></div>
<p><strong>Structural decomposition</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">    </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">    </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="p">}</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span><span class="c1">// struct</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="nc">a</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="nc">b</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="c1">// &lt;--- if names of variables are different</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;On the x axis at {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;On the y axis at {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;On neither axis: ({}, {})&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">    </span><span class="c1">// Enums:</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">Message</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">        </span><span class="n">Quit</span><span class="p">,</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">        </span><span class="n">Move</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">::</span><span class="n">Move</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">160</span><span class="p">);</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">        </span><span class="n">Message</span><span class="p">::</span><span class="n">Quit</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">        </span><span class="n">Message</span><span class="p">::</span><span class="n">Move</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">    </span><span class="c1">// nested enums</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">      </span><span class="n">Message</span><span class="p">::</span><span class="n">ChangeColor</span><span class="p">(</span><span class="n">Color</span><span class="p">::</span><span class="n">Rgb</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w">    </span><span class="c1">// nested structs</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="w">    </span><span class="c1">//</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">((</span><span class="n">feet</span><span class="p">,</span><span class="w"> </span><span class="n">inches</span><span class="p">),</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span><span class="w"> </span><span class="p">});</span>
</code></pre></div>
<p><strong>Ignoring many parts of a value</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">match</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="o">..</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Some numbers: {first}, {last}&quot;</span><span class="p">);</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="p">}</span>
</code></pre></div>
<p><strong>arms can be used with <code>if</code></strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Got 50&quot;</span><span class="p">),</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Matched, n = {n}&quot;</span><span class="p">),</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">        </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Default case, x = {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<p><strong>storing matched value in a variable</strong>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Message</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="n">Hello</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">},</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="p">}</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="kd">let</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">::</span><span class="n">Hello</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="k">match</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="n">Message</span><span class="p">::</span><span class="n">Hello</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">        </span><span class="n">id</span><span class="p">:</span><span class="w"> </span><span class="nc">id_variable</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="mi">3</span><span class="o">..=</span><span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">        </span><span class="c1">//  ^^^^^^^^^^^^^</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">        </span><span class="c1">// will be assigned specific value</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Found an id in range: {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id_variable</span><span class="p">),</span>
</code></pre></div>
<hr />
<h2 id="traits"><strong>Traits</strong><a class="headerlink" href="#traits" title="Permanent link">&para;</a></h2>
<p>Traits are a mix of C++ concepts and CRTP and pure abstract interfaces:</p>
<ul>
<li>In the context of templates (aka generics), a trait defines an interface (== concept) and optionally some,
  default implementation (== CRTP).<ul>
<li>Concepts are compulsory: you will not be able to do much with a template type, unless its traits are
  specified (even if the type has the methods you are trying to call).</li>
<li>Traits can have typedefs: <code>type Item;</code> in <code>Iterator</code>.</li>
</ul>
</li>
<li>In the context of virtual functions (dyn Trait), trait defines an interface that is similar to pure virtual
  functions.</li>
</ul>
<p>Special functions are introduced as traits. For example if you need your type:</p>
<ul>
<li>to have a non-trivial destructor, you implement <code>Drop</code> trait for your type.<ul>
<li><code>std::mem::drop</code> can drop (call a destructor) earlier than it would happen otherwise.</li>
</ul>
</li>
<li>to implement <code>operator*</code> (in terms of C++), you implement <code>Deref</code> trait for your type.</li>
<li>to implement <code>operator+</code>, use <code>use std::ops::Add;</code>.</li>
</ul>
<p>Traits can &ldquo;inherit&rdquo; from other traits. In this case the derived trait says that type implementing it, should
also implement the base trait (which is called super-trait):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">trait</span><span class="w"> </span><span class="n">OutlinePrint</span><span class="p">:</span><span class="w"> </span><span class="nc">fmt</span><span class="p">::</span><span class="n">Display</span><span class="w"> </span><span class="p">{</span><span class="w">      </span><span class="c1">// Any type implementing OutlinePrint, should also implement fmt::Display</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">outline_print</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span><span class="w">  </span><span class="c1">// &lt;--- because we are using its functions here</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*&quot;</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="p">));</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;*{}*&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">len</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="p">}</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">    </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">,</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="p">}</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">fmt</span><span class="p">::</span><span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="fm">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;({}, {})&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="p">}</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="k">impl</span><span class="w"> </span><span class="n">OutlinePrint</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>Rust can choose an appropriate trait implementation based on self type. In the example below, map calls
<code>to_string</code> function of <code>ToString</code> trait and finds the correct implementation of the trait (<code>i32</code>):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">list_of_numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">list_of_strings</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="n">list_of_numbers</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="nb">ToString</span><span class="p">::</span><span class="n">to_string</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span>
</code></pre></div>
<p>Similar (explicit) syntax of calling a trait is also useful in case of collision of names of functions:</p>
<ul>
<li>
<p>Explicit specification if we have an object (<code>self</code>) which can be used to determine which function we
  wanted:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Human</span><span class="p">;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="n">Pilot</span><span class="p">::</span><span class="n">fly</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">);</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="n">Wizard</span><span class="p">::</span><span class="n">fly</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">);</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="n">person</span><span class="p">.</span><span class="n">fly</span><span class="p">();</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Explicit specification if we do not have an object (if the functions are static):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">trait</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">baby_name</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="p">;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="p">}</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Dog</span><span class="p">;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="k">impl</span><span class="w"> </span><span class="n">Dog</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">baby_name</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">&quot;Spot&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="p">}</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="k">impl</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Dog</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">baby_name</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">String</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">&quot;puppy&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="p">}</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;A baby dog is called a {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Dog</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Animal</span><span class="o">&gt;</span><span class="p">::</span><span class="n">baby_name</span><span class="p">());</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="w">    </span><span class="c1">//                                     ^^^^^^^^^^^^^</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="marker-traits"><strong>Marker traits</strong><a class="headerlink" href="#marker-traits" title="Permanent link">&para;</a></h4>
<p>Sometimes, there is some behaviour that you want to distinguish in the type system, but which cannot be
expressed as some specific method signature in a trait definition. For example, consider a trait for sorting
collections; an implementation might be stable (elements that compare the same will appear in the same order
before and after the sort) but there&rsquo;s no way to express this in the sort method arguments.</p>
<p>In this case, it&rsquo;s still worth using the type system to track this requirement, using a marker trait:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">Sort</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="sd">/// Re-arrange contents into sorted order.</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">sort</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">);</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="p">}</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="sd">/// Marker trait to indicate that a [`Sortable`] sorts stably.</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="k">pub</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="n">StableSort</span><span class="p">:</span><span class="w"> </span><span class="nc">Sort</span><span class="w"> </span><span class="p">{}</span>
</code></pre></div>
<p>A marker trait has no methods, but an implementation still has to declare that it is implementing the
trait. Code that relies on a stable sort can then specify the <code>StableSort</code> trait bound, relying on the
honour system to preserve its invariants. Use marker traits to distinguish behaviours that cannot be
expressed in the trait method signatures.</p>
<hr />
<h2 id="references-smart-pointers"><strong>References &amp; (smart) pointers</strong><a class="headerlink" href="#references-smart-pointers" title="Permanent link">&para;</a></h2>
<p>Unlike C++, references, pointers and smart-pointers are much more similar, and have same usage:</p>
<ul>
<li>References has to be dereferenced: <code class="highlight"><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">y</span><span class="p">);</span></code></li>
<li>It allows for interoperability with smart pointers: if we change <code>y</code> to be a <code>Box</code> the <code>assert</code> will still
  compile fine.</li>
</ul>
<hr />
<h2 id="other"><strong>Other</strong><a class="headerlink" href="#other" title="Permanent link">&para;</a></h2>
<h4 id="logical-const-ness-aka-mutable"><strong>Logical const-ness <span class="critic comment">aka mutable</span></strong><a class="headerlink" href="#logical-const-ness-aka-mutable" title="Permanent link">&para;</a></h4>
<p>Sometimes there is a field that should be changed on a const object (for example a counter of calls).</p>
<p>In C++, <code>mutable</code> or <code>const_cast&lt;&gt;()</code> are used. In Rust <code>RefCell&lt;T&gt;</code> is the solution: it allows us to get
mutable as well as immutable references, while enforcing borrow-checker invariants in run-time (the app will
crash if more than one mutable reference has been requested).</p>
<h4 id="clone-vs-clone-vs-operator"><strong>::clone vs .clone vs <code>operator=</code></strong><a class="headerlink" href="#clone-vs-clone-vs-operator" title="Permanent link">&para;</a></h4>
<p>The idea is that <code>.clone()</code> perform a deep-copy. It allows us to quickly find places in the code that can be
slow.</p>
<p>Everything else is supposed and designed to be fast (for example, assigning is a copy if it is an small type,
such an integer, or a move otherwise). This is also why Rc pointer is supposed to be copied by</p>
<details class="info">
<summary><code>::clone</code>, not <code>.clone()</code></summary>
<blockquote>
<p>We could have called a.clone() rather than Rc::clone(&amp;a), but Rust’s convention is to use Rc::clone in
  this case. The implementation of Rc::clone doesn’t make a deep copy of all the data like most types’
  implementations of clone do. The call to Rc::clone only increments the reference count, which doesn’t
  take much time. By using Rc::clone for reference counting, we can visually distinguish between the
  deep-copy kinds of clones and the kinds of clones that increase the reference count.</p>
<p>When looking for performance problems in the code, we only need to consider the deep-copy clones and
  can disregard calls to Rc::clone</p>
</blockquote>
</details>
<h4 id="multithreading"><strong>Multithreading</strong><a class="headerlink" href="#multithreading" title="Permanent link">&para;</a></h4>
<p>There are both: message-passing as well as mutexes.</p>
<ul>
<li>Mutex wraps and owns a data-structure.</li>
</ul>
<h4 id="using-typedefs"><strong>Using &amp; Typedefs</strong><a class="headerlink" href="#using-typedefs" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">type</span><span class="w"> </span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">result</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="c1">// Same as:</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="c1">// template &lt;class T&gt;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="c1">// using Result = std::result::Result&lt;T, std::io::Error&gt;;</span>
</code></pre></div>
<h4 id="arrays"><strong>Arrays</strong><a class="headerlink" href="#arrays" title="Permanent link">&para;</a></h4>
<ul>
<li>set every value to the same thing with <code>let x = [val; N]</code></li>
<li>specify each member individually with <code>let x = [val1, val2, val3]</code></li>
</ul>
<hr />
<h2 id="conversions"><strong>Conversions</strong><a class="headerlink" href="#conversions" title="Permanent link">&para;</a></h2>
<ul>
<li><code>char::from_u32</code></li>
<li><code>char::from_u32_unchecked</code></li>
</ul>
<h4 id="almost-no-implicit-conversions"><strong>Almost no implicit conversions</strong><a class="headerlink" href="#almost-no-implicit-conversions" title="Permanent link">&para;</a></h4>
<p>Rust has very few implicit conversions (coercions). Even save integer conversions must be done explicitly:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// ERROR!</span>
</code></pre></div>
<h4 id="but-it-might-appear-that-it-has-implicit-conversions"><strong>But it <em>might appear</em> that it has implicit conversions</strong><a class="headerlink" href="#but-it-might-appear-that-it-has-implicit-conversions" title="Permanent link">&para;</a></h4>
<p>But sometimes it <em>might appear</em> that it has implicit conversions:</p>
<p>Given these:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1">// Integer value from an IANA-controlled range.</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="cp">#[derive(Clone, Copy, Debug)]</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">IanaAllocated</span><span class="p">(</span><span class="k">pub</span><span class="w"> </span><span class="kt">u64</span><span class="p">);</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="c1">// Need this implementation of From:</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="kt">u64</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">IanaAllocated</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">from</span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">        </span><span class="bp">Self</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="p">}</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="c1">// Need also this function that takes a trait bound (template):</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">is_iana_reserved</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="nc">where</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">    </span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="n">IanaAllocated</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="p">{</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">into</span><span class="p">();</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">    </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">65535</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="p">}</span>
</code></pre></div>
<p>you can call the last function with just an integer:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">is_iana_reserved</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div>
<h4 id="types-of-casts"><strong>Types of casts</strong><a class="headerlink" href="#types-of-casts" title="Permanent link">&para;</a></h4>
<ul>
<li>User defined From / TryFrom</li>
<li><code>as</code></li>
<li>Coercion (implicit conversion)<ul>
<li>Hardcoded in compiler:<ul>
<li>mutable reference to a non-mutable references</li>
<li>reference to a raw pointer (this isn&rsquo;t unsafe)</li>
<li>closure that happens not to capture any variables into a bare function pointer</li>
<li>array to a slice</li>
<li>concrete item to a trait object</li>
<li>item lifetime to a &ldquo;shorter&rdquo; one</li>
<li>The second coercion of a user-defined type happens when a concrete item is converted to a trait
  object. This operation builds a fat pointer to the item; this pointer is fat because it includes
  both a pointer to the item&rsquo;s location in memory, together with a pointer to the vtable for the
  concrete type&rsquo;s implementation of the trait</li>
</ul>
</li>
<li>Using user-defined functions<ul>
<li>
<p>user-defined type implements the <code>Deref</code> or the <code>DerefMut</code> trait. These traits indicate that the
  user defined type is acting as a smart pointer of some sort</p>
<p>In particular, a method that expects a reference argument like <code>&amp;Point</code> can also be fed a
<code>&amp;Box&lt;Point&gt;</code>, thanks to Deref implemented by <code>Box</code>.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="fat-pointers-trait-objects"><strong>Fat pointers &amp; trait objects</strong><a class="headerlink" href="#fat-pointers-trait-objects" title="Permanent link">&para;</a></h4>
<p>Slice in Rust: <code>&amp;[u64]</code> is considered to be a &ldquo;fat pointer&rdquo; because it consists two things: start position
and length (aka <code>std::span</code>).</p>
<p>The second built-in fat pointer type is a trait object: a reference to some item that implements a particular
trait. It&rsquo;s built from a simple pointer to the item, together with an internal pointer to the type&rsquo;s vtable,
giving a size of 16 bytes (on a 64-bit platform). The vtable for a type&rsquo;s implementation of a trait holds
function pointers for each of the method implementations, allowing dynamic dispatch at runtime.</p>
<p>So, this notation: <code>&amp;dyn Trait</code> makes this separation clear (it means the pointer is &ldquo;fat&rdquo;).</p>
<p>Another interesting peculiarity is that it is impossible to cast an object that implements X interface,
which is itself derived from Y to Y. While you can use functions from both X and Y, you cannot cast it to Y.</p>
<p>Let&rsquo;s say we have this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">trait</span><span class="w"> </span><span class="n">Shape</span><span class="p">:</span><span class="w"> </span><span class="nc">Drawable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">render_in</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">bounds</span><span class="p">:</span><span class="w"> </span><span class="nc">Bounds</span><span class="p">);</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">render</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">render_in</span><span class="p">(</span><span class="n">overlap</span><span class="p">(</span><span class="n">SCREEN_BOUNDS</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">()));</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="p">}</span>
</code></pre></div>
<p>then, a method that accepts a <code>Shape</code> trait object:</p>
<ul>
<li>can use the methods from <code>Drawable</code> (because <code>Shape</code> also-implements <code>Drawable</code>, and because the relevant
  function pointers are present in the <code>Shape</code> vtable)</li>
<li>but cannot pass/cast the trait object on to another method that expects a <code>Drawable</code> trait object (because
  <code>Shape</code> is-not Drawable, and because the <code>Drawable</code> vtable isn&rsquo;t available).</li>
</ul>
<p>This is in contrast to generic method that accepts items that implement <code>Shape</code>:</p>
<ul>
<li>which can use methods from <code>Drawable</code></li>
<li>and which can pass the item on to another generic method that has a <code>Drawable</code> trait bound, because the
  trait bound is monomorphized at compile time to use the Drawable methods of the concrete type.</li>
</ul>
<h4 id="deref-vs-asreft"><strong>Deref vs AsRef&lt;T&gt;</strong><a class="headerlink" href="#deref-vs-asreft" title="Permanent link">&para;</a></h4>
<p>The Deref traits can&rsquo;t be generic (per-target: <code>Deref&lt;Target&gt;</code>) for the destination type. If they were, then
it would be possible for some type <code>ConfusedPtr</code> to implement both <code>Deref&lt;TypeA&gt;</code> and <code>Deref&lt;TypeB&gt;</code>, and
that would leave the compiler unable to deduce a single unique type for an expression like <code>*x</code>. So instead
the destination type is encoded as the associated type named Target.</p>
<p>This is in contrast to two other standard pointer traits, the <code>AsRef</code> and <code>AsMut</code> traits. These traits don&rsquo;t
induce special behaviour in the compiler, but also allow conversions to a reference or mutable reference via
an explicit call to their trait functions (<code>as_ref()</code> and <code>as_mut()</code> respectively). The destination type for
these conversions is encoded as a type parameter (e.g. <code>AsRef&lt;Point&gt;</code>), which means that a single container
type can support multiple destinations.</p>
<h4 id="borrow-vs-asreft-toowned-cow"><strong>Borrow vs AsRef&lt;T&gt; &amp; ToOwned &amp; Cow</strong><a class="headerlink" href="#borrow-vs-asreft-toowned-cow" title="Permanent link">&para;</a></h4>
<p><code>Borrow</code> and <code>BorrowMut</code> traits each have a single method (<code>borrow</code> and <code>borrow_mut</code> respectively). This
method has the same signature as the equivalent <code>AsRef</code> / <code>AsMut</code> trait methods.</p>
<p>The key difference in intents between these traits is visible via the blanket implementations that the
standard library provides. Given an arbitrary Rust reference <code>&amp;T</code>, there is a blanket implementation of
both <code>AsRef</code> and <code>Borrow</code>.</p>
<p>However, <code>Borrow</code> also has a blanket implementation for (non-reference) types: <code>impl&lt;T&gt; Borrow&lt;T&gt; for T</code></p>
<p>This means that a method accepting the <code>Borrow</code> trait can cope equally with instances of <code>T</code> as well as
references-to-T:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">add_four</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nc">std</span><span class="p">::</span><span class="n">borrow</span><span class="p">::</span><span class="n">Borrow</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">v</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="n">v</span><span class="p">.</span><span class="n">borrow</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="p">}</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">add_four</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">add_four</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
</code></pre></div>
<p>The standard library&rsquo;s container types have more realistic uses of <code>Borrow</code>; for example, <code>HashMap::get</code>
uses <code>Borrow</code> to allow convenient retrieval of entries whether keyed by value or by reference.</p>
<p>The <code>ToOwned</code> trait builds on the <code>Borrow</code> trait, adding a <code>to_owned()</code> method that produces a new owned
item of the underlying type. This is a generalization of the <code>Clone</code> trait: where <code>Clone</code> specifically
requires a Rust reference <code>&amp;T</code>, <code>ToOwned</code> instead copes with things that implement <code>Borrow</code>.</p>
<p>This means that:</p>
<ul>
<li>A function that operates on references to some type can accept <code>Borrow</code> so that it can also be called
  with moved items as well as references.</li>
<li>A function that operates on owned items of some type can accept <code>ToOwned</code> so that it can also be called
  with references to items as well as moved items; any references passed to it will be replicated into a
  locally owned item.</li>
</ul>
<p>Although it&rsquo;s not a pointer type, it&rsquo;s worth mentioning the <code>Cow</code> type at this point, because it provides
an alternative way of dealing with the same kind of situation. <code>Cow</code> is an enum that can hold either owned
data, or a reference to borrowed data. A <code>Cow</code> input can stay as borrowed data right up to the point where
it needs to be modified, but becomes an owned copy at the point where the data needs to be altered.</p>
<hr />
<h2 id="self-referential-data-structures-pin"><strong>Self-Referential Data Structures &amp; Pin</strong><a class="headerlink" href="#self-referential-data-structures-pin" title="Permanent link">&para;</a></h2>
<p>Self-Referential Data Structure is a struct that contains a mixture of owned data together with references to
within that owned data:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">SelfRef</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">   </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">   </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="c1">// The slice of `text` that holds the title text.</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="p">}</span>
</code></pre></div>
<p>The main reason why it does not &ldquo;just&rdquo; work is move semantics:</p>
<p>Data structures can move: from the stack to the heap, from the heap to the stack, and from one place to
another. If that happens, the &ldquo;interior&rdquo; <code>title</code> pointer would no longer be valid, and there&rsquo;s no way to
keep it in sync.</p>
<p>There is one workaround and one proper solution.</p>
<p>A simple alternative for this case is to use the indexing approach; a range of offsets into the text is
not invalidated by a move, and is invisible to the borrow checker because it doesn&rsquo;t involve references:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">SelfRefIdx</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">   </span><span class="n">text</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">   </span><span class="n">title</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Range</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="c1">// Indices into `text` where the title text is.</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="p">}</span>
</code></pre></div>
<p>However, this indexing approach only works for simple examples. A more general version of the self-reference
problem turns up when the compiler deals with async code. Roughly speaking, the compiler bundles up a
pending chunk of async code into a lambda, and the data for that lambda can include both values and
references to those values.</p>
<p>That&rsquo;s inherently a self-referential data structure, and so async support was a prime motivation for the
<code>Pin</code> type in the standard library. This pointer type &ldquo;pins&rdquo; its value in place, forcing the value to
remain at the same location in memory, thus ensuring that internal self-references remain valid.</p>
<p>So <code>Pin</code> is available as a possibility for self-referential types, but it&rsquo;s tricky to use correctly (as
its official docs make clear):</p>
<ul>
<li>The internal reference fields need to use raw pointers, or near relatives (e.g. NonNull) thereof.</li>
<li>The type being pinned needs to not implement the Unpin marker trait. This trait is automatically
  implemented for almost every type, so this typically involves adding a (zero-sized) field of type
  PhantomPinned to the struct definition.</li>
<li>The item is only pinned once it&rsquo;s on the heap and held via Pin; in other words, only the contents of
  something like Pin<Box\<MyType>> is pinned. This means that the internal reference fields can only be
  safely filled in after this point, but as they are raw pointers the compiler will give you no warning
  if you incorrectly set them before calling <code>Box::pin</code>.</li>
</ul>
<hr />
<h2 id="iterators"><strong>Iterators</strong><a class="headerlink" href="#iterators" title="Permanent link">&para;</a></h2>
<h4 id="iterator-trait"><strong>Iterator Trait</strong><a class="headerlink" href="#iterator-trait" title="Permanent link">&para;</a></h4>
<p>Despite being able to iterate over elements, references to elements and mutable references to elements of
a collection, there is only <em>one</em> trait.</p>
<p>Collections that allow iteration over their contents – called iterables – implement the <code>IntoIterator</code> trait.
The <code>into_iter</code> method of this trait consumes <code>Self</code> and emits an Iterator in its stead.</p>
<p>But the catch is that <code>Self</code> is either <code>Vec&lt;_&gt;</code> or <code>&amp;Vec&lt;_&gt;</code> or &amp;mut <code>Vec&lt;_&gt;</code>.</p>
<p>The compiler will automatically use this trait for expressions of the form:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="c1">// body</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="p">}</span>
</code></pre></div>
<h4 id="iterator-transformations"><strong>Iterator transformations</strong><a class="headerlink" href="#iterator-transformations" title="Permanent link">&para;</a></h4>
<p>Some of these tranformations affect the overall iteration process:</p>
<ul>
<li><code>take(n)</code>, <code>skip(n)</code></li>
<li><code>take_while()</code> and <code>skip_while()</code>: same as above, but based on a predicate.</li>
<li><code>filter(|item| {...})</code> is the most general version</li>
<li><code>step_by(n)</code>:emits every n-th item.</li>
<li><code>rev()</code> reverses the direction of an iterator.</li>
<li><code>cycle()</code>: converts an iterator that terminates into one that repeats forever, starting at the beginning
  again whenever it reaches the end. (The iterator must support Clone to allow this.)</li>
<li><code>partition</code>: splits an iterator into two collections based on a predicate</li>
</ul>
<p>Combining iterators:</p>
<ul>
<li><code>chain(other)</code> glues together two iterators, to build a combined iterator that moves through one then
  the other.</li>
<li><code>zip(it)</code>, <code>unzip</code>: zip joins an iterator with a second iterator, to produce a combined iterator that emits pairs of
  items, one from each of the original iterators, until the shorter of the two iterators is finished.</li>
<li>The <code>flatten()</code> method deals with an iterator whose items are themselves iterators, flattening the result.
  On its own, this doesn&rsquo;t seem that helpful, but it becomes much more useful when combined with the
  observation that both <code>Option</code> and <code>Result</code> act as iterators: they produce either zero
  (for <code>None</code>, <code>Err(e)</code>) or one (for <code>Some(v)</code>, <code>Ok(v)</code>) items. This means that flattening a stream of
  <code>Option</code> / <code>Result</code> values is a simple way to extract just the valid values, ignoring the rest.</li>
</ul>
<p>Other transformations affect the nature of the Item that&rsquo;s the subject of the Iterator:</p>
<ul>
<li><code>map(|item| {...})</code> repeatedly applies a closure to transform each item in turn.</li>
<li><code>cloned()</code> produces a clone of all of the items in the original iterator; this is particularly useful with
  iterators over &amp;Item references.</li>
<li><code>copied()</code> produces a copy of all of the items in the original iterator; this is particularly useful
  with iterators over &amp;Item references.</li>
<li><code>enumerate()</code> converts an iterator over items to be an iterator over (usize, Item) pairs</li>
</ul>
<p>Finally, iterator consumers:</p>
<ul>
<li>
<p>Building a single value out of the collection:</p>
<ul>
<li><code>sum()</code>, <code>product()</code></li>
<li><code>min()</code>, <code>max()</code></li>
<li><code>min_by(f)</code>, <code>max_by(f)</code> for finding the extreme values of a collection</li>
<li><code>reduce(f)</code> is a more general operation that encompasses the previous methods, building an
  accumulated value of the Item type by running a closure at each step that takes the value accumulated
  so far and the current item.</li>
<li><code>fold(f)</code>, <code>try_fold</code> is a generalization of <code>reduce</code>, allowing the &ldquo;accumulated value&rdquo; to be of an arbitrary
  type (not just the <code>Iterator::Item</code> type).</li>
<li><code>scan(f)</code> generalizes in a slightly different way, giving the closure a mutable reference to some
  internal state at each step.</li>
</ul>
</li>
<li>
<p>Selecting a single value out of the collection:</p>
<ul>
<li><code>find(p)</code>, <code>try_find</code> finds the first item that satisfies a predicate</li>
<li><code>position(p)</code> also finds the first item satisfying a predicate, but this time it returns the index of
  the item.</li>
<li><code>nth(n)</code> returns the n-th element of the iterator, if available.</li>
</ul>
</li>
<li>
<p>Testing against every item in the collection:</p>
<ul>
<li><code>any(p)</code> indicates whether a predicate is true for any item</li>
<li><code>all(p)</code> indicates whether a predicate is true for all items</li>
</ul>
</li>
<li>
<p>Accumulate all of the iterated items into a new collection:</p>
<ul>
<li>
<p><code>collect()</code>. In addition to transforming an iterator into a new collection, it can also transform
  a sequence of Result&rsquo;s into Result of a sequence:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">res</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">in</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">::</span><span class="n">try_from</span><span class="p">(</span><span class="n">v</span><span class="p">)).</span><span class="n">collect</span><span class="p">::</span><span class="o">&lt;</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
</code></pre></div>
</li>
</ul>
</li>
</ul>
<hr />
<h2 id="ffi-foreign-function-interface"><strong>FFI: foreign function interface</strong><a class="headerlink" href="#ffi-foreign-function-interface" title="Permanent link">&para;</a></h2>
<p>It is possible to call C/C++ function from within Rust (and vice-versa).
See <a href="https://lurklurk.org/effective-rust/ffi.html">this</a> for general info and
<a href="https://lurklurk.org/effective-rust/bindgen.html">bindgen</a> for C bindings and <a href="https://cxx.rs/">cxx</a> for C++.</p>
<hr />
<h2 id="macros"><strong>Macros</strong><a class="headerlink" href="#macros" title="Permanent link">&para;</a></h2>
<h4 id="declarative-macros"><strong>Declarative Macros</strong><a class="headerlink" href="#declarative-macros" title="Permanent link">&para;</a></h4>
<p>The <a href="https://github.com/dtolnay/cargo-expand">cargo-expand</a> tool shows the code that the compiler sees,
after macro expansion:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="fm">macro_rules!</span><span class="w"> </span><span class="n">inc_item</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="cp">$x</span><span class="p">:</span><span class="nc">ident</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cp">$x</span><span class="p">.</span><span class="n">contents</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="p">}</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">contents</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">};</span><span class="w"> </span><span class="c1">// type is not `Copy`</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="n">inc_item</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;x is {x:?}&quot;</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Item</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">contents</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">x</span><span class="p">.</span><span class="n">contents</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="p">{</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="p">::</span><span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">_print</span><span class="p">(</span><span class="fm">format_args!</span><span class="p">(</span><span class="s">&quot;x is {0:?}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">));</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="p">};</span>
</code></pre></div>
<h4 id="procedural-macros"><strong>Procedural Macros</strong><a class="headerlink" href="#procedural-macros" title="Permanent link">&para;</a></h4>
<p>There are three distinct types of procedural macro:</p>
<ul>
<li>
<p>Function-like macros: Invoked with an argument:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">my_func_macro</span><span class="o">!</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">f32</span><span class="p">::</span><span class="n">consts</span><span class="p">::</span><span class="n">PI</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>Attribute macros: Attached to some chunk of syntax in the program:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="cp">#[log_invocation]</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="k">fn</span><span class="w"> </span><span class="nf">add_three</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Derive macros: Attached to the definition of a data structure.</p>
<p>Derive macros add to the input tokens, instead of replacing them altogether. This means that the data
structure definition is left intact but the macro has the opportunity to append related code.</p>
<p>Derive macro can declare associated helper attributes, which can then be used to mark parts of the data
structure that need special processing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="cp">#[derive(Debug, Deserialize)]</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MyData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">    </span><span class="c1">// If `value` is missing when deserializing, invoke</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="w">    </span><span class="c1">// `generate_value()` to populate the field instead.</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="w">    </span><span class="cp">#[serde(default = </span><span class="s">&quot;generate_value&quot;</span><span class="cp">)]</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="w">    </span><span class="n">value</span><span class="p">:</span><span class="w"> </span><span class="nb">String</span><span class="p">,</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<hr />
<h2 id="unsafe-rust"><strong>Unsafe Rust</strong><a class="headerlink" href="#unsafe-rust" title="Permanent link">&para;</a></h2>
<p>There is an interesting asymmetry between trust:</p>
<ul>
<li>safe code trusts unsafe code (trust is based on assumption that unsafe code was manually checked / verified)</li>
<li>
<p>but, unsafe code cannot trust safe code</p>
<p>For example, BTreeMap cannot trust that <code>Ord</code> trait has been implemented correctly for the key user type.
While this might counter-intuitive, the reason for this is that a logical error in implementation of
safe code (<code>Ord</code>) leads to a much larger issues in unsafe code. If a faulty <code>Ord</code> implementation is used
in safe code, rust will catch it (in the sense that it will not cause memory-related issues). But this is
not the case for unsafe code using a faulty implementation of <code>Ord</code>.</p>
</li>
</ul>
<h4 id="exotically-sized-types"><strong>Exotically Sized Types</strong><a class="headerlink" href="#exotically-sized-types" title="Permanent link">&para;</a></h4>
<p>There are two major DSTs (dynamically sized types) exposed by the language:</p>
<ul>
<li>trait objects: <code>dyn MyTrait</code></li>
<li>slices: <code>[T]</code>, <code>str</code>, and others</li>
</ul>
<p>See Wide/Fat pointers &amp; trait objects above.</p>
<p>Structs can actually store a single DST directly as their last field, but this makes them a DST as well:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1">// Can&#39;t be stored on the stack directly</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MySuperSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">    </span><span class="n">info</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="p">}</span>
</code></pre></div>
<p>Although such a type is largely useless without a way to construct it. Currently the only properly supported
way to create a custom DST is by making your type generic and performing an unsizing coercion:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MySuperSliceable</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="w">    </span><span class="n">info</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">,</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="w">    </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="p">}</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sized</span><span class="p">:</span><span class="w"> </span><span class="nc">MySuperSliceable</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">8</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MySuperSliceable</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="w">        </span><span class="n">info</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="w">        </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">8</span><span class="p">],</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">dynamic</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="nc">MySuperSliceable</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">u8</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sized</span><span class="p">;</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="w">    </span><span class="c1">// prints: &quot;17 [0, 0, 0, 0, 0, 0, 0, 0]&quot;</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{} {:?}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dynamic</span><span class="p">.</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">dynamic</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="p">}</span>
</code></pre></div>
<p>Rust also allows types to be specified that occupy no space:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Nothing</span><span class="p">;</span><span class="w"> </span><span class="c1">// No fields = no size</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="c1">// All fields have no size = no size</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">LotsOfNothing</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="w">    </span><span class="n">foo</span><span class="p">:</span><span class="w"> </span><span class="nc">Nothing</span><span class="p">,</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="w">    </span><span class="n">qux</span><span class="p">:</span><span class="w"> </span><span class="p">(),</span><span class="w">      </span><span class="c1">// empty tuple has no size</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="w">    </span><span class="n">baz</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="c1">// empty array has no size</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="p">}</span>
</code></pre></div>
<p>Rust also enables types to be declared that cannot even be instantiated. These types can only be talked about
at the type level, and never at the value level. Empty types can be declared by specifying an enum with
no variants:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="k">enum</span><span class="w"> </span><span class="nc">Void</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// No variants = EMPTY</span>
</code></pre></div>
<h4 id="struct-layout-types-reprc-reprtransparent-repru-repri-reprpacked-repralignn"><strong>Struct layout types: repr(C), repr(transparent), repr(u<em>), repr(i</em>), repr(packed), repr(align(n))</strong><a class="headerlink" href="#struct-layout-types-reprc-reprtransparent-repru-repri-reprpacked-repralignn" title="Permanent link">&para;</a></h4>
<p>Use <code>repr(C)</code> to pass a struct through FFI or be able to manually control layout (disable Rust tricks,
enabled by default)</p>
<h4 id="lifetimes"><strong>Lifetimes</strong><a class="headerlink" href="#lifetimes" title="Permanent link">&para;</a></h4>
<p>Lifetime positions can appear as either &ldquo;input&rdquo; or &ldquo;output&rdquo;:</p>
<p>For <code>fn</code> definitions, <code>fn</code> types, and the traits <code>Fn</code>, <code>FnMut</code>, and <code>FnOnce</code>, input refers to the types of
the formal arguments, while output refers to result types. So fn <code>foo(s: &amp;str) -&gt; (&amp;str, &amp;str)</code> has elided
one lifetime in input position and two lifetimes in output position.</p>
<p>There is also the logic that allows to change lifetime from one to another (from longer one, such as
&lsquo;static to a shorter one). This is called subtyping. And this is why this code compilers:</p>
<p>In almost any context, when you see some requirement of a longer lifetime, like &lsquo;static, it is possible to
&ldquo;convert&rdquo; it to smaller (because &lsquo;static lives as long as a smaller lifetime). This property is called
&ldquo;being covariant&rdquo;.</p>
<p>But this is wrong for function arguments. Function arguments require that a parameter live at least as long
as given lifetime (&lsquo;static). Unlike the case above, we can NOT use a parameter with smaller lifetime for
function argument that requires &lsquo;static. This property is called &ldquo;being contravariant&rdquo;.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">debug</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;a = {a:?} b = {b:?}&quot;</span><span class="p">);</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="p">}</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">hello</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">;</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span><span class="p">::</span><span class="n">from</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">);</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">world</span><span class="p">;</span><span class="w"> </span><span class="c1">// &#39;world has a shorter lifetime than &#39;static</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="w">        </span><span class="n">debug</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span><span class="w"> </span><span class="n">world</span><span class="p">);</span><span class="w"> </span><span class="c1">// hello silently downgrades from `&amp;&#39;static str` into `&amp;&#39;world str`</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="p">}</span>
</code></pre></div>
<p>We&rsquo;re going to pretend that we&rsquo;re actually allowed to label scopes with lifetimes, and desugar the examples
from the start of this chapter. One particularly interesting piece of sugar is that each let statement
implicitly introduces a scope</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="c1">// desugars to:</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="o">&#39;</span><span class="na">a</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">    </span><span class="o">&#39;</span><span class="na">b</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">z</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">b</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w">        </span><span class="o">&#39;</span><span class="na">c</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w">            </span><span class="c1">// Must use &#39;b here because the reference to x is</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">            </span><span class="c1">// being passed to the scope &#39;b.</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">b</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;&#39;</span><span class="na">b</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w">            </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="p">}</span>
</code></pre></div>
<p>Example: references that outlive referents</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">as_str</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">    </span><span class="o">&amp;</span><span class="n">s</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="p">}</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="c1">// desugars to:</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="k">fn</span><span class="w"> </span><span class="nf">as_str</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">    </span><span class="o">&#39;</span><span class="na">b</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;&#39;</span><span class="na">a</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="p">}</span>
</code></pre></div>
<p>This signature of <code>as_str</code> takes a reference to a <code>u32</code> with some lifetime, and promises that it can produce
a reference to a <code>str</code> that can live just as long. Already we can see why this signature might be trouble.
That basically implies that we&rsquo;re going to find a <code>str</code> somewhere in the scope the reference to the
<code>u32</code> originated in, or somewhere even earlier.</p>
<p>Since the contract of our function says the reference must outlive &lsquo;a, that&rsquo;s the lifetime we infer for the
reference. Unfortunately, s was defined in the scope &lsquo;b, so the only way this is sound is if &lsquo;b contains
&lsquo;a &ndash; which is clearly false since &lsquo;a must contain the function call itself. We have therefore created a
reference whose lifetime outlives its referent.</p>
<p>To make this more clear, we can expand the example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">as_str</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="o">&#39;</span><span class="na">b</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;&#39;</span><span class="na">a</span><span class="w"> </span><span class="n">s</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="p">}</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">    </span><span class="o">&#39;</span><span class="na">c</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">u32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">        </span><span class="o">&#39;</span><span class="na">d</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">            </span><span class="c1">// An anonymous scope is introduced because the borrow does not</span>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">            </span><span class="c1">// need to last for the whole scope x is valid for. The return</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">            </span><span class="c1">// of as_str must find a str somewhere before this function</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">            </span><span class="c1">// call. Obviously not happening.</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">as_str</span><span class="p">::</span><span class="o">&lt;&#39;</span><span class="na">d</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;&#39;</span><span class="na">d</span><span class="w"> </span><span class="n">x</span><span class="p">));</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="p">}</span>
</code></pre></div>
<p>This is another example that shows why Rust thinks that if a function that takes a reference to X
(<code>Vec&lt;u8&gt;</code>) is called, and the function returns a reference to Y (<code>u8</code>), then there is a reference to
X in the scope (even if we consider lines after the function).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">data</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="o">&#39;</span><span class="na">a</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">data</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">    </span><span class="o">&#39;</span><span class="na">b</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">        </span><span class="c1">// &#39;b is as big as we need this borrow to be</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">        </span><span class="c1">// (just need to get to `println!`)</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">b</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Index</span><span class="p">::</span><span class="n">index</span><span class="p">::</span><span class="o">&lt;&#39;</span><span class="na">b</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;&#39;</span><span class="na">b</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="w">        </span><span class="o">&#39;</span><span class="na">c</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">            </span><span class="c1">// Temporary scope because we don&#39;t need the</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="w">            </span><span class="c1">// &amp;mut to last any longer.</span>
<a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="w">            </span><span class="nb">Vec</span><span class="p">::</span><span class="n">push</span><span class="p">(</span><span class="o">&amp;&#39;</span><span class="na">c</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="p">}</span>
</code></pre></div>
<p>The problem here is a bit more subtle and interesting. We want Rust to reject this program for the
following reason: We have a live shared reference x to a descendant of data when we try to take a
mutable reference to data to push. This would create an aliased mutable reference, which would violate
the second rule of references.</p>
<p>However this is not at all how Rust reasons that this program is bad. Rust <strong>doesn&rsquo;t understand that x is
a reference to a part of data</strong>. It doesn&rsquo;t understand Vec at all. What it does see is that x has to
live for &lsquo;b in order to be printed. The signature of Index::index subsequently demands that the reference
we assign to <code>data</code> <strong>has to survive for &lsquo;b</strong> (&lt;&mdash; this is exactly what makes rust think that a mutable
reference to vector exists after the function call). When we try to call push, it then sees us try to
make an &amp;&rsquo;c mut data. Rust knows that &lsquo;c is contained within &lsquo;b, and rejects our program because the
&amp;&rsquo;b data reference must still be alive!</p>
<h4 id="lifetime-elision"><strong>Lifetime Elision</strong><a class="headerlink" href="#lifetime-elision" title="Permanent link">&para;</a></h4>
<ul>
<li>Each elided lifetime in input position becomes a distinct lifetime parameter.</li>
<li>If there is exactly one input lifetime position (elided or not), that lifetime is assigned to all elided
  output lifetimes.</li>
<li>If there are multiple input lifetime positions, but one of them is &amp;self or &amp;mut self, the lifetime of
  self is assigned to all elided output lifetimes.</li>
<li>Otherwise, it is an error to elide an output lifetime.</li>
</ul>
<h4 id="drop-check"><strong>Drop Check</strong><a class="headerlink" href="#drop-check" title="Permanent link">&para;</a></h4>
<p>There are some checks performed by rust when a type that holds references is dropped. This code causes
compilation error:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Inspector</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">u8</span><span class="p">);</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="k">impl</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Inspector</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;I was only {} days from retirement!&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="p">}</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">World</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">    </span><span class="n">inspector</span><span class="p">:</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Inspector</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="w">    </span><span class="n">days</span><span class="p">:</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="p">}</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">world</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">World</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">        </span><span class="n">inspector</span><span class="p">:</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">        </span><span class="n">days</span><span class="p">:</span><span class="w"> </span><span class="nb">Box</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a><span class="w">    </span><span class="n">world</span><span class="p">.</span><span class="n">inspector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Inspector</span><span class="p">(</span><span class="o">&amp;</span><span class="n">world</span><span class="p">.</span><span class="n">days</span><span class="p">));</span>
<a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">    </span><span class="c1">// Let&#39;s say `days` happens to get dropped first.</span>
<a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">    </span><span class="c1">// Then when Inspector is dropped, it will try to read free&#39;d memory!</span>
<a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="p">}</span>
</code></pre></div>
<p>because drop access the references, which is not guaranteed to live long enough.</p>
<p>If you need circumvent this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="cp">#![feature(dropck_eyepatch)]</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Inspector</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;&#39;</span><span class="nb">static</span><span class="w"> </span><span class="kt">str</span><span class="p">);</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="k">unsafe</span><span class="w"> </span><span class="k">impl</span><span class="o">&lt;</span><span class="cp">#[may_dangle]</span><span class="w"> </span><span class="o">&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Inspector</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Inspector(_, {}) knows when *not* to inspect.&quot;</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="p">}</span>
</code></pre></div>
<h4 id="phantomdata"><strong>PhantomData</strong><a class="headerlink" href="#phantomdata" title="Permanent link">&para;</a></h4>
<p>When working with unsafe code, we can often end up in a situation where types or lifetimes are logically
associated with a struct, but not actually part of a field. This most commonly occurs with lifetimes.
For instance, the Iter for &amp;&rsquo;a [T] is (approximately) defined as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Iter</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="o">&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">    </span><span class="n">ptr</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">    </span><span class="n">end</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="p">}</span>
</code></pre></div>
<p>PhantomData is a special marker type. PhantomData consumes no space, but simulates a field of the given type
for the purpose of static analysis. This was deemed to be less error-prone than explicitly telling the
type-system the kind of variance that you want, while also providing other useful things such as auto
traits and the information needed by drop check.</p>
<p>Iter logically contains a bunch of <code>&amp;'a T</code>s, so this is exactly what we tell the PhantomData to simulate:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">marker</span><span class="p">;</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Iter</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="o">&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">    </span><span class="n">ptr</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">    </span><span class="n">end</span><span class="p">:</span><span class="w"> </span><span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">    </span><span class="n">_marker</span><span class="p">:</span><span class="w"> </span><span class="nc">marker</span><span class="p">::</span><span class="n">PhantomData</span><span class="o">&lt;&amp;&#39;</span><span class="na">a</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="p">}</span>
</code></pre></div>
<p>and that&rsquo;s it. The lifetime will be bounded, and your iterator will be covariant over &lsquo;a and T.</p>
<h4 id="splitting-borrows"><strong>Splitting Borrows</strong><a class="headerlink" href="#splitting-borrows" title="Permanent link">&para;</a></h4>
<p>borrowck doesn&rsquo;t understand arrays or slices in any way, so this doesn&rsquo;t work:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{} {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
</code></pre></div>
<p>In order to &ldquo;teach&rdquo; borrowck that what we&rsquo;re doing is ok, we need to drop down to unsafe code. For instance,
mutable slices expose a <code>split_at_mut</code> function that consumes the slice and returns two mutable slices.
One for everything to the left of the index, and one for everything to the right. Intuitively we know this is
safe because the slices don&rsquo;t overlap, and therefore alias. However the implementation requires some unsafety:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">split_at_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="n">T</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">as_mut_ptr</span><span class="p">();</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">        </span><span class="fm">assert!</span><span class="p">(</span><span class="n">mid</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">len</span><span class="p">);</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="w">        </span><span class="p">(</span><span class="n">from_raw_parts_mut</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">),</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="w">         </span><span class="n">from_raw_parts_mut</span><span class="p">(</span><span class="n">ptr</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">mid</span><span class="p">),</span><span class="w"> </span><span class="n">len</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mid</span><span class="p">))</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="p">}</span>
</code></pre></div>
<h4 id="the-dot-operator"><strong>The Dot Operator</strong><a class="headerlink" href="#the-dot-operator" title="Permanent link">&para;</a></h4>
<p>Suppose we have a function <code>foo</code> that has a receiver (a <code>self</code>, <code>&amp;self</code> or <code>&amp;mut self</code> parameter). If we
call <code>value.foo()</code>, the compiler needs to determine what type <code>Self</code> is before it can call the correct
implementation of the function. For this example, we will say that <code>value</code> has type <code>T</code>.</p>
<p>We will use fully-qualified syntax to be more clear about exactly which type we are calling a function on.</p>
<ul>
<li>First, the compiler checks if it can call <code>T::foo(value)</code> directly. This is called a &ldquo;by value&rdquo; method call.</li>
<li>If it can&rsquo;t call this function (for example, if the function has the wrong type or a trait isn&rsquo;t
  implemented for <code>Self</code>), then the compiler tries to add in an automatic reference. This means that the
  compiler tries <code>&lt;&amp;T&gt;::foo(value)</code> and <code>&lt;&amp;mut T&gt;::foo(value)</code>. This is called an &ldquo;autoref&rdquo; method call.</li>
<li>If none of these candidates worked, it dereferences <code>T</code> and tries again. This uses the <code>Deref</code> trait - if
  T: <code>Deref&lt;Target = U&gt;</code> then it tries again with type <code>U</code> instead of <code>T</code>. If it can&rsquo;t dereference <code>T</code>, it
  can also try unsizing <code>T</code>. This just means that if T has a size parameter known at compile time, it
  &ldquo;forgets&rdquo; it for the purpose of resolving methods. For instance, this unsizing step can convert
  <code>[i32; 2]</code> into <code>[i32]</code> by &ldquo;forgetting&rdquo; the size of the array.</li>
</ul>
<p>Example of the method lookup algorithm:</p>
<ul>
<li>
<p>Let&rsquo;s say we have this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="kd">let</span><span class="w"> </span><span class="n">array</span><span class="p">:</span><span class="w"> </span><span class="nc">Rc</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="p">[</span><span class="n">T</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">..</span><span class="p">.;</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="kd">let</span><span class="w"> </span><span class="n">first_entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</code></pre></div>
</li>
<li>
<p>First, <code>array[0]</code> is really just syntax sugar for the <code>Index</code> trait - the compiler will convert <code>array[0]</code>
  into <code>array.index(0)</code>. Now, the compiler checks to see if array implements <code>Index</code></p>
</li>
<li>
<p>The compiler checks if <code>Rc&lt;Box&lt;[T; 3]&gt;&gt;</code> implements <code>Index</code>, but it does not, and neither do
  <code>&amp;Rc&lt;Box&lt;[T; 3]&gt;&gt;</code> or <code>&amp;mut Rc&lt;Box&lt;[T; 3]&gt;&gt;</code>.</p>
</li>
<li>Since none of these worked, the compiler dereferences the <code>Rc&lt;Box&lt;[T; 3]&gt;&gt;</code> into <code>Box&lt;[T; 3]&gt;</code> and tries
  again. <code>Box&lt;[T; 3]&gt;</code>, <code>&amp;Box&lt;[T; 3]&gt;</code>, and <code>&amp;mut Box&lt;[T; 3]&gt;</code> do not implement <code>Index</code>,</li>
<li>So it dereferences again. <code>[T; 3]</code> and its autorefs also do not implement <code>Index</code>. It can&rsquo;t
  dereference <code>[T; 3]</code>, so the compiler unsizes it, giving <code>[T]</code>. Finally, <code>[T]</code> implements <code>Index</code>, so it
  can now call the actual index function.</li>
</ul>
<h4 id="transmutes-aka-reinterpret_cast"><strong>Transmutes</strong> (aka reinterpret_cast)<a class="headerlink" href="#transmutes-aka-reinterpret_cast" title="Permanent link">&para;</a></h4>
<p><code>mem::transmute&lt;T, U&gt;</code> takes a value of type <code>T</code> and reinterprets it to have type <code>U</code>. The only restriction
is that the <code>T</code> and <code>U</code> are verified to have the same size. The ways to cause Undefined Behavior with this
are mind boggling.</p>
<ul>
<li>
<p>First and foremost, creating an instance of any type with an invalid state is going to cause arbitrary
  chaos that can&rsquo;t really be predicted. Do not transmute 3 to bool. Even if you never do anything with
  the bool. Just don&rsquo;t.</p>
</li>
<li>
<p>Transmute has an overloaded return type. If you do not specify the return type it may produce a surprising
  type to satisfy inference.</p>
</li>
<li>
<p>Transmuting an <code>&amp;</code> to <code>&amp;mut</code> is Undefined Behavior. While certain usages may appear safe, note that the
  Rust optimizer is free to assume that a shared reference won&rsquo;t change through its lifetime and thus such
  transmutation will run afoul of those assumptions.</p>
</li>
<li>
<p>When transmuting between different compound types, you have to make sure they are laid out the same way!
  If layouts differ, the wrong fields are going to get filled with the wrong data, which will make you
  unhappy and can also be Undefined Behavior (see above).</p>
<p>So how do you know if the layouts are the same? For <code>repr(C)</code> types and <code>repr(transparent)</code> types, layout
is precisely defined. But for your run-of-the-mill <code>repr(Rust)</code>, it is not. Even different instances of
the same generic type can have wildly different layout. <code>Vec&lt;i32&gt;</code> and <code>Vec&lt;u32&gt;</code> <em>might</em> have their
fields in the same order, or they might not.</p>
</li>
</ul>
<h4 id="working-with-uninitialized-memory"><strong>Working With Uninitialized Memory</strong><a class="headerlink" href="#working-with-uninitialized-memory" title="Permanent link">&para;</a></h4>
<p>Like C, all stack variables in Rust are uninitialized until a value is explicitly assigned to them.
Unlike C, Rust statically prevents you from ever reading them until you do. Interestingly, Rust doesn&rsquo;t
require the variable to be mutable to perform a delayed initialization.</p>
<p>So this compiles:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;{}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="p">}</span>
</code></pre></div>
<p>There is an interesting case for partially initialised arrays: Safe Rust doesn&rsquo;t permit you to partially
initialize an array.</p>
<p>Unsafe Rust gives us a powerful tool to handle this problem:
<a href="https://doc.rust-lang.org/core/mem/union.MaybeUninit.html"><code>MaybeUninit</code></a>. This type can be used to handle
memory that has not been fully initialized yet. Example of usage:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">mem</span><span class="p">::{</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">MaybeUninit</span><span class="p">};</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="c1">// Size of the array is hard-coded but easy to change (meaning, changing just the constant is</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="c1">// sufficient). This means we can&#39;t use [a, b, c] syntax to initialize the array, though, as we would</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="c1">// have to keep that in sync with `SIZE`!</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="k">const</span><span class="w"> </span><span class="n">SIZE</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">    </span><span class="c1">// Create an uninitialized array of `MaybeUninit`. The `assume_init` is safe because the type we are</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="w">    </span><span class="c1">// claiming to have initialized here is a bunch of `MaybeUninit`s, which do not require initialization.</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">MaybeUninit</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w"> </span><span class="n">SIZE</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="w">        </span><span class="n">MaybeUninit</span><span class="p">::</span><span class="n">uninit</span><span class="p">().</span><span class="n">assume_init</span><span class="p">()</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="w">    </span><span class="c1">// Dropping a `MaybeUninit` does nothing. Thus using raw pointer assignment instead of `ptr::write`</span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="w">    </span><span class="c1">// does not cause the old uninitialized value to be dropped.</span>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">SIZE</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a><span class="w">        </span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaybeUninit</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="nb">Box</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">));</span>
<a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a>
<a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a><span class="w">    </span><span class="c1">// Everything is initialized. Transmute the array to the initialized type.</span>
<a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">mem</span><span class="p">::</span><span class="n">transmute</span><span class="p">::</span><span class="o">&lt;</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nb">Box</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="p">;</span><span class="w"> </span><span class="n">SIZE</span><span class="p">]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-58-23" name="__codelineno-58-23" href="#__codelineno-58-23"></a><span class="p">};</span>
<a id="__codelineno-58-24" name="__codelineno-58-24" href="#__codelineno-58-24"></a>
<a id="__codelineno-58-25" name="__codelineno-58-25" href="#__codelineno-58-25"></a><span class="fm">dbg!</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</code></pre></div>
<p>It&rsquo;s worth spending a bit more time on the loop in the middle, and in particular the assignment operator
and its interaction with drop. If we wrote something like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">as_mut_ptr</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Box</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">u32</span><span class="p">);</span><span class="w"> </span><span class="c1">// WRONG!</span>
</code></pre></div>
<p>we would actually overwrite a <code>Box&lt;u32&gt;</code>, leading to drop of uninitialized data, which would cause much
sadness and pain.</p>
<p>The correct alternative, if for some reason we cannot use <code>MaybeUninit::new</code>, is to use the <code>ptr</code> module.
In particular, it provides three functions that allow us to assign bytes to a location in memory without
dropping the old value: <code>write</code>, <code>copy</code>, and <code>copy_nonoverlapping</code>.</p>
<ul>
<li><code>ptr::write(ptr, val)</code> takes a val and moves it into the address pointed to by ptr.</li>
<li><code>ptr::copy(src, dest, count)</code> copies the bits that count T items would occupy from src to dest. (this
  is equivalent to C&rsquo;s memmove &ndash; note that the argument order is reversed!)</li>
<li><code>ptr::copy_nonoverlapping(src, dest, count)</code> does what copy does, but a little faster on the assumption
  that the two ranges of memory don&rsquo;t overlap. (this is equivalent to C&rsquo;s memcpy &ndash; note that the argument
  order is reversed!)</li>
</ul>
<p>It&rsquo;s worth noting that you don&rsquo;t need to worry about ptr::write-style shenanigans with types which don&rsquo;t
implement Drop or contain Drop types, because Rust knows not to try to drop them. This is what we relied
on in the above example.</p>
<p>Note that, to use the ptr methods, you need to first obtain a raw pointer to the data you want to initialize.
It is illegal to construct a reference to uninitialized data, which implies that you have to be careful when
obtaining said raw pointer:</p>
<ul>
<li>For an array of T, you can use <code>base_ptr.add(idx)</code> where <code>base_ptr: *mut T</code> to compute the address of array
  index idx. This relies on how arrays are laid out in memory.</li>
<li>
<p>For a struct, however, in general we do not know how it is laid out, and we also cannot use
  <code>&amp;mut base_ptr.field</code> as that would be creating a reference. So, you must carefully use the <code>addr_of_mut</code>
  macro. This creates a raw pointer to the field without creating an intermediate reference:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::{</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="n">mem</span><span class="p">::</span><span class="n">MaybeUninit</span><span class="p">};</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Demo</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">    </span><span class="n">field</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="p">}</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">uninit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MaybeUninit</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Demo</span><span class="o">&gt;</span><span class="p">::</span><span class="n">uninit</span><span class="p">();</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="c1">// `&amp;uninit.as_mut().field` would create a reference to an uninitialized `bool`,</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="c1">// and thus be Undefined Behavior!</span>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="kd">let</span><span class="w"> </span><span class="n">f1_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ptr</span><span class="p">::</span><span class="n">addr_of_mut</span><span class="o">!</span><span class="p">((</span><span class="o">*</span><span class="n">uninit</span><span class="p">.</span><span class="n">as_mut_ptr</span><span class="p">()).</span><span class="n">field</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">f1_ptr</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="kd">let</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">uninit</span><span class="p">.</span><span class="n">assume_init</span><span class="p">()</span><span class="w"> </span><span class="p">};</span>
</code></pre></div>
</li>
</ul>
<h4 id="leaking"><strong>Leaking</strong><a class="headerlink" href="#leaking" title="Permanent link">&para;</a></h4>
<p>Sometimes, leaking just causes&hellip; leaks. But it sometimes it leads to memory issues.</p>
<ul>
<li>
<p>vec example: <code>drainer</code> is an entity that remembers what elements were drained, and whenever its
  destructor (drop) is called, it shifts remaining elements of vector, overwriting &ldquo;drained&rdquo; ones. The
  problem is to implement this correctly in the face of code like: <code>mem::forget(drainer)</code>: if we are not
  careful, user can use the elements that were drained.</p>
<p>The solution is to temporarily set_len to 0 (and restore it in drainer&rsquo;s drop). Which means that if
user <code>mem::forget(drainer)</code>, the length of vector will be 0, and the user cannot read any element.</p>
</li>
<li>
<p>Another example is implementation of Rc. It has a reference counter. If we are allowed to <code>mem::forget</code>
  then we can overflow it (which means we can make it 0 as many times as we want), but it will lead to double
  free. The solution is NOT to overflow (but crash, for example).</p>
</li>
</ul>
<h4 id="exceptions"><strong>Exceptions</strong><a class="headerlink" href="#exceptions" title="Permanent link">&para;</a></h4>
<p>While Rust does not have exceptions in the sense of C++, code in Rust can panic, and one of the possibilities
for what happens is exception &amp; stack unwinding. It means that unsafe code should either use low-level C-like
functions which cannot throw exceptions / panic, or it should be ready for an exception.</p>
<p>Example 1: Vec::push_all</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="w"> </span><span class="nb">Clone</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">push_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">to_push</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">[</span><span class="n">T</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">to_push</span><span class="p">.</span><span class="n">len</span><span class="p">());</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">        </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">            </span><span class="c1">// can&#39;t overflow because we just reserved this</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">set_len</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">to_push</span><span class="p">.</span><span class="n">len</span><span class="p">());</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">to_push</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">enumerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w">                </span><span class="bp">self</span><span class="p">.</span><span class="n">ptr</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="p">}</span>
</code></pre></div>
<p>Need to move set_len to after the loop, as otherwise we set_len and then x.clone() can panic.</p>
<p>There is also <a href="https://doc.rust-lang.org/nomicon/exception-safety.html#binaryheapsift_up">an example</a> of how
to &ldquo;emulate&rdquo; try/catch block</p>
<hr />
<h2 id="std-types"><strong>std types</strong><a class="headerlink" href="#std-types" title="Permanent link">&para;</a></h2>
<p>Some &ldquo;notable&rdquo; combinations of smart-pointers:</p>
<ul>
<li><code>Rc&lt;RefCell&lt;T&gt;&gt;</code>: for interior mutability in single-threaded code</li>
<li><code>Arc&lt;Mutex&lt;T&gt;&gt;</code>: for interior mutability in multithreaded code</li>
</ul>
<h4 id="other_1"><strong>Other</strong><a class="headerlink" href="#other_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>std::any</code></li>
</ul>
<hr />
<h2 id="useful-crates"><strong>Useful crates</strong><a class="headerlink" href="#useful-crates" title="Permanent link">&para;</a></h2>
<ul>
<li>anyhow error</li>
<li><a href="https://docs.rs/derive_builder/latest/derive_builder/">derive_builder</a></li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "navigation.tabs", "navigation.expand", "navigation.top", "content.tabs.link", "content.code.annotate"], "search": "../assets/javascripts/workers/search.c7c1ca2c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.203fd0bc.min.js"></script>
      
        <script src="../assets/javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>